<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>SUMO Dashboard</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bootstrap-Select CSS –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ dropdown -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css"
    />
    <style>
      /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
      body.hidden {
        display: none;
      }

      /* Grid layout: header + sidebar + main + right panel */
      html, body { height: 100%; margin: 0; padding: 0; }
      .dashboard-header { grid-area: header; }
      .dashboard-layout { display: grid; grid-template-rows: auto 1fr; grid-template-columns: 0 1fr 300px; grid-template-areas: "header header header" "sidebar main right"; transition: grid-template-columns .3s; padding-top: 60px;}
      aside.sidebar { overflow: hidden; }
      main.main-content { grid-area: main; padding:0.5rem 2rem; overflow-y:auto; }
      aside.right-panel { grid-area: right; background: rgba(255,255,255,0.15); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-left:1px solid rgba(255,255,255,0.3); box-shadow:-4px 0 24px rgba(0,0,0,0.08); border-radius:16px 0 0 16px; padding:1rem; overflow-y:auto; }
      .dashboard-layout.sidebar-open {
        grid-template-columns: 250px 1fr 300px;       /* –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º –º–µ–Ω—é */
      }

      /* Glass-card base */
      .glass-card, .stats-card, .platform-card, .alert-card, .filter-panel {
        background: rgba(255,255,255,0.12);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border:1px solid rgba(255,255,255,0.3);
        box-shadow:0 10px 40px rgba(0,0,0,0.06);
        border-radius:16px;
        padding:1rem;
        margin-bottom:1rem;
        transition:transform .3s, box-shadow .3s;
      }
      .stats-card:hover, .platform-card:hover, .alert-card:hover, .filter-panel:hover { transform:translateY(-4px); box-shadow:0 14px 48px rgba(0,0,0,0.1); }

      /* Header styling */
      .dashboard-header nav.navbar { position:sticky; top:0; z-index:100; }

      /* Sidebar menu inside aside.sidebar */
      aside.sidebar #sidebar { background:var(--menu-bg-color, #fff); border-radius:8px; overflow:hidden; }
      aside.sidebar #sidebar a { display:flex; align-items:center; gap:8px; padding:8px; color:var(--text-color,#343a40); text-decoration:none; border-bottom:1px solid rgba(0,0,0,0.05); }
      aside.sidebar #sidebar a:hover { background:rgba(0,0,0,0.05); }

      /* Filter panel */
      .filter-panel { display:flex; flex-wrap:wrap; gap:12px; max-width:1200px; margin:0 auto 24px; padding: 16px 24px !important; border-radius: 30px !important;}
      .filter-panel .filter-dropdown, .filter-panel .search-input { background:rgba(255,255,255,0.25); border:1px solid rgba(255,255,255,0.4); border-radius:20px !important; padding:10px 16px !important; min-width:120px; transition: background 0.2s, border-color 0.2s; box-shadow: 0.2s; }
      .filter-panel .filter-dropdown:hover, .filter-panel .filter-dropdown:focus, .filter-panel .search-input:hover, .filter-panel .search-input:focus { background:rgba(255,255,255,0.35); border-color:rgba(255,255,255,0.6); outline:none; }
      
      /* Stats cards grid */
      #summary-grid {
        display: grid !important;
        /* —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ –∫–æ–ª–æ–Ω–æ–∫, –Ω–æ –º–∏–Ω–∏–º—É–º –ø–æ 180px –∏ –º–∞–∫—Å–∏–º—É–º 1fr */
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)) !important;
        gap: 1rem !important;
        /* —Ç—è–Ω–µ–º –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É —Ä–æ–¥–∏—Ç–µ–ª—è */
        width: 100% !important;
        max-width: none !important;
        margin: 0 !important;
        padding-bottom: 0;
        justify-items: stretch;
      }

      .stats-title { font-size:.75rem; color:#6c757d; text-transform:uppercase; letter-spacing:.05rem; }
      .stats-value { font-size:1.4rem; font-weight:700; margin:0.3rem 0; }
      .stats-card.small-font-card .stats-value { font-size:1rem; }

      #find-candidate { border-radius: 20px;}
      /* Platforms row */
      /* 1) –û–±—â–∏–µ —Å—Ç–∞—Ç—ã ‚Äî –ø—É—Å—Ç—å –æ—Å—Ç–∞—é—Ç—Å—è flex‚Äô–æ–º –∏–ª–∏ –∫–∞–∫ –≤–∞–º —É–¥–æ–±–Ω–æ */
      #summary-general {
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)) !important;
  gap: 1rem !important;
  width: 100% !important;
  margin-bottom: 1.5rem;
}


/* 2) –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—ã ‚Äî grid —Å —Ç–µ–º –∂–µ —à–∞–±–ª–æ–Ω–æ–º, —á—Ç–æ –∏ platform-card */
#summary-platforms {
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)) !important;
  gap: 1rem !important;
  width: 100% !important;
  margin: 0 0 1.5rem 0;
}

/* 3) –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ ‚Äî —Ç–æ–∂–µ grid, —Ç–æ—á–Ω–æ –ø–æ —ç—Ç–∏–º –∂–µ –∫–æ–ª–æ–Ω–∫–∞–º */
.platforms-row {
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)) !important;
  gap: 1rem !important;
  width: 100% !important;
  margin: 0 !important;
  align-items: start !important;
}


      .platform-card { flex:1 1 220px; min-width:200px; overflow-wrap:break-word; }
      .platform-card h5 { margin-bottom:.5rem; font-weight:600; }
      .platform-card ul { list-style:none; padding:0; margin:0; }
      .platform-card li { padding:.25rem 0; }

      /* Alerts */
      #alerts-section { display:flex; flex-wrap:wrap; gap:1.5rem; justify-content:center; }
      .alert-card { flex:0 1 320px; max-width:400px; display:flex; flex-direction:column; text-align:center; justify-content:flex-start; }
      .alert-card h2 { margin-bottom:1rem; font-weight:500; }
      .alert-content { flex:1; overflow-y:auto; }

      /* Responsive */
      @media(max-width:768px) {
        .dashboard-layout { grid-template-columns:1fr; grid-template-areas:"header" "main" "right" "sidebar"; height:auto; }
        aside.sidebar, aside.right-panel { width:100%; border-radius:0; box-shadow:none; }
      }

      :root {
        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        --bg-color: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
        --text-color: #343a40;
        --card-bg-color: #ffffff;
        --card-text-color: #495057;
        --card-border-color: #dee2e6;
        --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        --card-hover-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        --menu-bg-color: #ffffff;
        --menu-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
        --menu-width: 250px;
        --transition-speed: 0.3s;
      }
      /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
      body.dark-theme {
        --bg-color: linear-gradient(120deg, #252525 0%, #313131 100%);
        --text-color: #f0f0f0;
        --card-bg-color: #3a3a3a;
        --card-text-color: #e5e5e5;
        --card-border-color: #555555;
        --card-shadow: 0 4px 16px rgba(255, 255, 255, 0.08);
        --card-hover-shadow: 0 6px 20px rgba(255, 255, 255, 0.12);
        --menu-bg-color: #3a3a3a;
      }

      body.dark-theme .stats-card.red-card {
        background-color: #4a1f1f !important;
        border: 1px solid #dc3545 !important;
      }

      /* –û–±—â–∏–π —Å–±—Ä–æ—Å –∏ —Ñ–æ–Ω */
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        min-height: 100vh;
        background: var(--bg-color);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow-x: hidden;
        color: var(--text-color);
        transition: background var(--transition-speed) ease,
          color var(--transition-speed) ease;
      }

      /* –°—Ç–∏–ª—å –¥–ª—è –±–ª–æ–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –∫–Ω–æ–ø–∫–æ–π –≤—ã—Ö–æ–¥–∞ */
      #user-info {
        text-align: right;
        padding: 10px;
        font-size: 1rem;
        color: var(--text-color);
      }
      .notifications-dropdown {
        position: absolute;
        top: calc(100% + 20px);    /* –ø—Ä—è–º–æ –ø–æ–¥ –∏–∫–æ–Ω–∫–æ–π */
        right: -135px;     /* –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        width: 300px; /* –∏–ª–∏ –≤–∞—à–∞ —à–∏—Ä–∏–Ω–∞ */
        max-height: 400px;
        overflow-y: auto;
        background: var(--card-bg-color);
        border: 1px solid var(--card-border-color);
        box-shadow: var(--card-shadow);
        border-radius: 8px;
        z-index: 1000;
        display: none;
    }
    .notifications-dropdown.show {
      display: block;
    }
    .notifications-dropdown .unread {
      background-color: rgba(220,53,69,0.1);
      font-weight: bold;
    }
    .notifications-dropdown .read {
      background-color: transparent;
      color: var(--text-color);
    }

      /* –°–∞–π–¥–±–∞—Ä (–º–µ–Ω—é) */
      .hamburger-menu {
        margin-right: 12px;
        cursor: pointer;
      }
      .hamburger-menu span {
        font-size: 28px;
        color: var(--text-color);
      }
      #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 100%;
        background: var(--menu-bg-color);
        box-shadow: 2px 0 12px rgba(0, 0, 0, 0.2);
        transition: transform .3s;
        z-index: 200 !important;
        padding: 30px 20px;
        transform: translate(-100%);
      }
      aside.sidebar #sidebar {
        position: fixed;             /* —á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ–ª–æ –æ—Ç –ø–æ—Ç–æ–∫–∞ */
        top: 60px !important;        /* –ø–æ–¥ —à–∞–ø–∫—É */
        height: calc(100% - 60px);   /* –∑–∞–Ω–∏–º–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
        z-index: 90;                 /* —á—É—Ç—å –Ω–∏–∂–µ —à–∞–ø–∫–∏ */
      }

      #sidebar.active {
        transform: translateX(0);
      }
      #sidebar-close {
        position-absolute;
        top: 12px;
        right: 12px;
        z-index: 91;
      }

      #sidebar a {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 10px;
        font-size: 1rem;
        color: var(--text-color);
        border-bottom: 1px solid var(--card-border-color);
        transition: background 0.2s ease, transform 0.2s ease;
        text-decoration: none;
      }

      #sidebar a:hover {
        background: rgba(0, 123, 255, 0.05);
        transform: translateX(4px);
        border-radius: 6px;
      }

      #sidebar .close-btn {
        font-size: 24px;
        text-align: right;
        cursor: pointer;
        color: var(--text-color);
        margin-bottom: 20px;
      }

      body.dark-theme #sidebar {
        background: #2b2b2b;
      }

      body.dark-theme #sidebar a {
        color: #f0f0f0;
      }

      body.dark-theme #sidebar a:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .dashboard-container {
        width: 100%;
        margin: 0;
        padding: 20px;
        box-sizing: border-box;
      }
      h1 {
        text-align: center;
        margin-bottom: 20px;
        font-weight: 500;
        font-size: 2rem;
        color: var(--text-color);
      }

      /* –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
      .filter-panel {
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 12px 24px;
        margin: 0 auto 24px;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 16px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        border: 1px solid rgba(255,255,255,0.3);
        max-width: 1200px;
      }
      .filter-panel .filter-dropdown {
        background: rgba(255,255,255,0.2);
        border: 1px solid rgba(255,255,255,0.4);
        border-radius: 8px;
        padding: 8px 12px;
        min-width: 140px;
        transition: background 0.2s ease, border-color 0.2s ease;
      }
      .filter-panel .filter-dropdown:hover,
      .filter-panel .filter-dropdown:focus,
      .filter-panel .search-input:hover,
      .filter-panel .search-input:focus {
        background: rgba(255,255,255,0.3);      
        border-color: rgba(255,255,255,0.6); /* –ø–æ–¥—á–µ—Ä–∫–Ω—ë–º —Ü–≤–µ—Ç–æ–º –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ */
        outline: none;
      }
      .filter-panel .bootstrap-select .dropdown-toggle {
        height: 100% !important;
        padding: 0 16px !important; /* —Å–ª–µ–≤–∞-—Å–ø—Ä–∞–≤–∞ –∫–∞–∫ —É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö */
        display: flex;
        align-items: center;
        box-shadow: none !important;
        border-radius: 20px !important;
      }
      .filter-panel .bootstrap-select .dropdown-toggle .filter-option-inner-inner {
        display: flex;
        align-items: center;
        height: 100%;
      }
      /* –≤—ã–ø–∞–¥–∞—à–∫–∞ —Ç–æ–∂–µ –∑–∞–∫—Ä—É–≥–ª—è–µ—Ç—Å—è */
      .filter-panel .bootstrap-select .dropdown-menu {
        border-radius: 20px;
      }
      #summary-grid {
      display: grid !important;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)) !important;
      gap: 1rem !important;
      width: 100% !important;      /* —Ç—è–Ω–µ–º –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É —Ä–æ–¥–∏—Ç–µ–ª—è */
      margin: 0 !important;        /* –±–µ–∑ –∞–≤—Ç–æ-–æ—Ç—Å—Ç—É–ø–æ–≤ */
      padding: 0;
    }

      .stats-card {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 8px;
        padding: 0.8rem 0.6rem !important;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 16px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255,255,255,0.3);
        min-width: 180px;
      }
      .stats-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      }
      .stats-card .stats-title {
        font-size: 0.75rem;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.05rem;
        margin-bottom: 0.3rem;
      }
      .stats-card .stats-value {
        font-size: 1.4rem;
        font-weight: 700;
        color: #343a40;
        margin-bottom: 0.2rem;
      }
      .stats-card .small {
        font-size: 0.75rem;
        color: #868e96;
        margin-top: 0.25rem;
      }
      .stats-card .info-icon {
        width: 1rem;
        height: 1rem;
        marging-left: 0.5rem !important;
        filter: grayscale(100%);
        transition: filter 0.2s ease;
        cursor: pointer;
      }
      .stats-card .info-icon:hover {
        filter: none;
      }
      .stats-value.d-inline-flex {
        gap: 0.25rem  !important;
        align-items: center !important;
      }
      .stats-card.red-card {
        background-color: #fff5ff;
        border: 1px solid #ff6b6b;     /* –∫—Ä–∞—Å–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ */
      }
      .stats-title {
        font-size: 0.9rem;
        opacity: 0.7;
      }
      .stats-value {
        font-weight: bold;
        font-size: 1.2rem;
        margin-top: 4px;
      }
      .red-card {
        background-color: #ffe5e5;
        border-color: #dc3545;     /* –∫—Ä–∞—Å–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ */
        border: 1px solid #ff6b6b;
      }
      .filter-section {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .filter-dropdown {
        padding: 8px 12px;
        border: 1px solid var(--card-border-color);
        border-radius: 6px;
        background: var(--card-bg-color);
        min-width: 120px;
        color: var(--text-color);
      }
      .search-section {
        display: flex;
        margin-left: auto;
      }
      .search-input {
        padding: 8px 12px;
        border: 1px solid var(--card-border-color);
        border-radius: 6px 0 0 6px;
        background: var(--card-bg-color);
        width: 150px;
        color: var(--text-color);
      }

      /* –°–µ–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
      .refresh-section {
        margin-left: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .refresh-btn {
        padding: 6px 10px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .refresh-btn, .refresh-section img {
        transition: transform .2s ease;
      }
      .refresh-btn:hover, .refresh-section img:hover {
        transform: scale(1.1);
      }
      .theme-switch .slider:before {
        font-size: 14px;
        line-height: 18px;
      }
      .refresh-btn:hover {
        background-color: #218838;
      }
      .spinner-border {
        width: 1rem;
        height: 1rem;
        border-width: 0.1em;
      }
      @media (max-width: 768px) {
        .filter-panel {
          justify-content: center;
        }
        .filter-panel .filter-dropdown,
        .filter-panel .search-input {
          min-width: 45%;
        }
      }
      /* –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
      .theme-text {
        margin: 0;
        padding: 0;
        line-height: 1;
        font-size: 1rem;
      }
      /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
      .theme-toggle-container {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .theme-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }
      .theme-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }
      .slider:before {
        position: absolute;
        content: "‚òÄÔ∏è";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
        font-size: 12px;
        line-height: 18px;
        text-align: center;
        color: #f39c12;
      }
      input:checked + .slider {
        background-color: #007bff;
      }
      input:checked + .slider:before {
        transform: translateX(26px);
        content: "üåô";
        color: #f1c40f;
      }

      /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏ —Ç–∞–±–ª–∏—Ü—ã */
      .platform-card {
        flex: 1 1 220px;
        min-width: 220px;
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.3);
        color: var(--card-text-color);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        overflow-wrap: break-word;
      }
      .platform-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--card-hover-shadow);
      }
      .platform-card h5 {
        text-align: center;
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 12px;
        color: var(--text-color);
      }
      .platform-card h5 .info-icon {
        display: inline-block;
        margin-left: 5px;
        cursor: pointer;
        font-size: 0.9rem;
        vertical-align: middle;
      }
      .platform-card p {
        text-align: center;
        margin: 10px 0;
        font-size: 0.85rem;
        color: #6c757d;
      }
      .platform-card ul {
        list-style: none;
        padding-left: 0;
        font-size: 0.85rem;
        color: var(--card-text-color);
      }
      .platform-card ul li {
        padding: 4px 0;
        cursor: pointer;
      }
      
      .platform-card ul li:not(:last-child) {
        border-bottom: 1px solid var(--card-border-color);
      }
      .platform-card ul li:last-child {
        border-bottom: none;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è –±–µ–π–¥–∂–µ–π —Å–º–µ–Ω—ã –ø–µ—Ä–µ–¥ –∏–º–µ–Ω–µ–º */
      .platform-card .badge {
        font-size: 0.75rem;
        vertical-align: middle;
      }
      .platform-card .badge-pill {
        padding: 0.25em 0.6em;
        margin-right: 0.4em;
      }

      .shift-summary-card {
        background: none !important;
        color: var(--card-text-color);
        border: none !important;
        box-shadow: none !important;
        padding: 20px;
        margin: 0 auto 40px;
        text-align: center;
        overflow-wrap: break-word;
        font-size: 1.2rem;
        font-weight: 700;
        border-radius:16px;
      }
      .shift-summary-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--card-hover-shadow);
      }
      .shift-summary-title {
        margin-bottom: 16px;
        font-weight: 600;
        font-size: 1.3rem;
        color: var(--text-color);
      }
      .shift-summary-grid {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        table-layout: auto;
        font-size: 2rem;
      }
      .shift-summary-grid th,
      .shift-summary-grid td {
        padding: 8px 12px;
        text-align: center;
        font-size: 0.85rem;
        color: var(--card-text-color);
      }
      .shift-summary-grid th {
        background: none !important;
        font-weight: 600;
      }
      .shift-summary-grid td {
        background: none !important;
        border: 1px solid var(--card-border-color);
        border-radius: 8px;
      }
      .small-font-card {
        font-size: 0.9rem;
      }
      .shift-card-title {
        font-size: 1.4rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        text-align: center;
      }
      .shift-card-away {
        font-size: 1.1rem;
        color: #666;
        text-align: center;
      }
      #breaks-section {
        margin-top: 40px;
      }

      #alerts-section #breaks-section {
        margin-top: 0;
      }
      
      #breaks-section h2 {
        text-align: center;
        margin-bottom: 20px;
        font-weight: 500;
        font-size: 1.5rem;
        color: var(--text-color);
      }
      /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–≤—É—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ */
      #alerts-section {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        justify-content: center;
        align-items: stretch;
        margin: 2rem 0;
      }
      
      /* –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–Ω—É—Ç—Ä–∏ */
      .alert-card {
        flex: 0 1 320px;      /* –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –±–æ–ª—å—à–µ –±–∞–∑–∏—Å–Ω–æ–π —à–∏—Ä–∏–Ω—ã */
        max-width: 400px;      /* –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
        align-self: stretch;   /* –∑–∞—Å—Ç–∞–≤–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—ã—Ç—å –æ–¥–Ω–æ–π –≤—ã—Å–æ—Ç—ã */
        background: rgba(255,255,255,0.1);
        border: 1px solid var(--card-border-color);
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 16px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        text-align: center;
        justify-content: center;
      }

      #breaks-app .break-card {
      margin-bottom: 0 !important;
      }

      .alert-content {
        flex: 1;             /* –∑–∞–π–º—ë—Ç –≤—Å—ë –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
        overflow-y: auto;    /* –µ—Å–ª–∏ –º–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ‚Äî –ø–æ—è–≤–∏—Ç—Å—è —Å–∫—Ä–æ–ª–ª */
      }
      
      /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
      .alert-card h2 {
        margin-bottom: 20px;
        font-weight: 500;
        font-size: 1.5rem;
        color: var(--text-color);
      }
      
      /* –ö–æ–Ω—Ç–µ–Ω—Ç-–æ–±–ª–∞—Å—Ç—å */
      .alert-card > div {
        flex: 1;
        overflow-y: auto;
      }

      .alert-card ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .alert-card li {
        margin-bottom: 0.75rem;
        line-height: 1.3;
      }
      @media (max-width: 768px) {
        .alert-card { max-width: 100%; }
      }

      .break-conflict > strong {
        color: #dc3545;
      }

      /* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ø–∏—Å–∫–∞ –≤–Ω—É—Ç—Ä–∏ */
      #shift-overs-app ul,
      #breaks-app ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      #shift-overs-app li,
      #breaks-app li {
        margin-bottom: 0.75rem;
      }

      .break-card {
        background: var(--card-bg-color);
        color: var(--card-text-color);
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        padding: 20px;
        margin: 0 auto 40px;
        max-width: 600px;
        text-align: center;
        overflow-wrap: break-word;
      }
      .break-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--card-hover-shadow);
      }
      .break-card h5 {
        margin-bottom: 12px;
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--text-color);
      }
      .break-card ul {
        list-style: none;
        padding-left: 0;
        font-size: 0.85rem;
        color: var(--card-text-color);
      }
      .break-card ul li {
        padding: 6px 0;
        border-bottom: 1px solid var(--card-border-color);
      }
      .break-card ul li:last-child {
        border-bottom: none;
      }

      /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ */
      #modal-overlay {
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        position:fixed;
        top : 0;
        left: 0;  
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }
      #employee-modal {
        opacity: 0;
        transform: translateX(-50%) scale(0.95);
        transition: opacity 0.3s ease, transform 0.3s ease;
        position: fixed;
        top: 20%;
        left: 50%;
        background: var(--card-bg-color);
        color: var(--card-text-color);
        border: 1px solid var(--card-border-color);
        box-shadow: var(--card-shadow);
        border-radius: 8px;
        padding: 20px;
        z-index: 1001;
        width: 330px;
        pointer-events: none;
        max-height: 80vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      #employee-modal.show {
        opacity: 1;
        transform: translateX(-50%) scale(1);
        pointer-events: auto;
      }

      #modal-overlay.show {
        opacity: 1;
        pointer-events: auto;
      }

      #employee-modal h3 {
        margin: 0 0 8px 0;
      }
      #employee-modal .close-btn {
        position: absolute;
        top: 8px;
        right: 12px;
        cursor: pointer;
        font-size: 20px;
      }
      #employee-modal a {
        color: #007bff;
        text-decoration: underline;
      }
      #employee-modal a:hover {
        color: #0056b3;
      }
      /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–Ω—Ñ–æ–π –∏ –∫–Ω–æ–ø–∫–∞–º–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É, –∞ –≤–æ—Ç —Å–ø–∏—Å–æ–∫ –¥–µ–ª–∞–µ–º —Å–∫—Ä–æ–ª–ª–∏–º—ã–º */
      #employee-modal > div:nth-of-type(2) {
        /* —ç—Ç–æ –∫–∞–∫ —Ä–∞–∑ <div> —Å padding –≤–æ–∫—Ä—É–≥ –≤—Å–µ–π —Ç–∞–±–ª–∏—á–∫–∏ –∏–Ω—Ñ—ã –∏ —Å–ø–∏—Å–∫–∞ */
        flex: 1 1 auto;
        overflow-y: auto;
      }
      
      /* –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –±–æ–ª–µ–µ —Ç–æ—á–µ—á–Ω–æ —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–æ–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: */
      #modal-platform-list {
        max-height: 200px;    /* –∏–ª–∏ —Å–∫–æ–ª—å–∫–æ –≤–∞–º –Ω—É–∂–Ω–æ */
        overflow-y: auto;
        margin-left: 20px;
        font-size: 0.9rem;
      }
      .dashboard-header {
        position: fixed;
        display: flex;
        padding: 1rem 2rem;
        min-height: 60px;
        justify-content: space-between;
        align-items: center;
        background: var(--card-bg-color);
        border-bottom: 1px solid var(--card-border-color);
        box-shadow: var(--card-shadow);
        border-radius: 0 0 12px 12px;
        position: sticky;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        z-index: 100;
      }
      .filters-wrapper {
        displax: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        border-radius: 30px !important;
        padding: 16px 24px !important;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(0,0,0,0.1) !important;
        box-shadow: var(--card-shadow);
        background-filter: blur(10px);
        flex: 1 1 auto;
        min-width: 0;
        max-width: 100%;
        margin: 0.25rem auto 24px;
        margin-top: -0.5rem;
      }
      .filters-wrapper .filter-dropdown {
      box-sizing: border-box;
      height: 40px;
      padding: 8px 16px;
      min-width: 120px; /* –∏–ª–∏ –ª—é–±—É—é –≤–∞—à—É —à–∏—Ä–∏–Ω—É */
      background: var(--card-bg-color);
      border: 1px solid var(--card-border-color);
      border-radius: 20px;
    }

    .filters-wrapper .bootstrap-select {
  width: auto !important;
  flex-shrink: 0;            /* –Ω–µ –¥–∞—ë–º —É–∂–∏–º–∞—Ç—å—Å—è */
  margin-right: 0.5rem;      /* —á—É—Ç—å –æ—Ç—Å—Ç—É–ø–∞ —Å–ø—Ä–∞–≤–∞ */
}

    /* –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ—Ç –∂–µ —Å—Ç–∏–ª—å –∫ –∫–Ω–æ–ø–∫–µ bootstrap-select */
    .filters-wrapper .bootstrap-select .dropdown-toggle.filter-dropdown {
      flex: 0 0 auto !important;
      box-sizing: border-box !important;
      height: 40px !important;
      padding: 8px 16px !important;
      min-width: 120px !important;
    }
      .filters-wrapper .filter-dropdown,
      .filters-wrapper .search-input {
        border-radius: 20px !important;
        padding: 10px 16px !important;
        transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
      }

      
      .filters-wrapper select,
      .filters-wrapper input {
        flex-shrink: 0;
      }
      @media (max-width: 768px) {
        .filters-wrapper {
          flex-direction: column;
          align-items: stretch;
        }
        .filters-wrapper > * {
          width: 100%;
        }
      }
      .header-gap > * {
        margin-right: 10px;
        margin-bottom: 6px;
      }
      .header-gap > *:last-child {
        margin-right: 0;
      }
      .info-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
        margin-bottom: 20px;
      }

      .aircall-status {
      font-weight: bold;
    }
    
    .status-available {
      color: green;
    }
    
    .status-on-a-call {
      color: orange;
    }
    
    .status-offline {
      color: gray;
    }
    
    .status-busy, .status-away {
      color: red;
    }


/* 4) –°–∫—Ä—É–≥–ª—è–µ–º —Å–∞–º–æ –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é */
.filters-wrapper .bootstrap-select .dropdown-menu {
  border-radius: 20px !important;
  background: var(--card-bg-color) !important;
  border: 1px solid var(--card-border-color) !important;
  box-shadow: none !important;
}
      /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—à—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Ç—ë–º–Ω–æ–≥–æ —Ñ–æ–Ω–∞ */
.shift-summary-card,
aside.right-panel .alert-card {
  background: var(--card-bg-color) !important;
  border: 1px solid var(--card-border-color) !important;
  box-shadow: var(--card-shadow) !important;
}

/* –ò —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ –Ω–∏—Ö —Ç–æ–∂–µ –±—ã–ª —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–º */
.shift-summary-card,
aside.right-panel .alert-card {
  color: var(--card-text-color) !important;
}

      
      /* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –¥–ª—è –ø–æ–ª—è Platform, –∏—Å–ø–æ–ª—å–∑—É–µ–º bootstrap‚Äëselect */
      .btn-outline-primary:hover {
        color: white !important;
        background-color: #007bff !important;
        border-color: #007bff !important;
      }

      body.dark-theme #employee-modal {
        background-color: #2b2b2b;
        color: #f0f0f0;
        border: 1px solid #444;
      }

      body.dark-theme #employee-modal h5 {
        color: #fff;
      }

      body.dark-theme #employee-modal small {
        color: #aaa;
      }

      body.dark-theme #employee-modal strong {
        color: #ddd;
      }

      body.dark-theme #employee-modal a,
      body.dark-theme #employee-modal .btn-outline-primary {
        color: #66b0ff;
        border-color: #66b0ff;
      }

      body.dark-theme #employee-modal .btn-outline-primary:hover {
        background-color: #66b0ff;
        color: white;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ dark-theme */
      body.dark-theme .stats-card {
        background: var(--card-bg-color) !important;    /* –∏–∑ –≤–∞—à–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã */
        border-color: var(--card-border-color) !important;
        color: var(--card-text-color) !important;       /* –æ–±—â–∏–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
      }

      /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ (stats-title) */
      body.dark-theme .stats-card .stats-title {
        color: rgba(255,255,255,0.7) !important;
      }

      /* –û—Å–Ω–æ–≤–Ω—ã–µ –±–æ–ª—å—à–∏–µ —Ü–∏—Ñ—Ä—ã (stats-value) */
      body.dark-theme .stats-card .stats-value {
        color: #ffffff !important;
      }

      /* –ú–µ–ª–∫–∏–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç (–∫–ª–∞—Å—Å .small –∏–ª–∏ inline) */
      body.dark-theme .stats-card .small,
      body.dark-theme .stats-card .stats-value small {
        color: rgba(255,255,255,0.6) !important;
      }

      body.dark-theme .platform-card,
      body.dark-theme .stats-card,
      body.dark-theme .alert-card {
        box-shadow: none !important;
      }

      body.dark-theme .platform-card .text-muted {
      color: #f1f1f1 !important;
     }
     /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∏ –¥–µ–ª–∞–µ–º —á—É—Ç—å –ø–æ–≥—É—â–µ */
    #user-display-name {
      font-size: 1.1rem;      /* –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥ —Å–≤–æ–π –≤–∫—É—Å */
      font-weight: 500;
    }
    /* —á—Ç–æ–±—ã –∞–Ω–∏–º–∞—Ü–∏—è –±—ã–ª–∞ –ø–ª–∞–≤–Ω–æ–π */
#notification-bell img {
  transition: filter 0.3s ease;
  position: relative;
}

/* –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ –ø—Ä–æ—Å—Ç–æ –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
body.dark-theme #notification-bell img {
  filter: invert(1) brightness(1.5);
}


    /* –í —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ –ø—É—Å—Ç—å –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∞—à —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ü–≤–µ—Ç */
    #user-display-name {
      color: var(--text-color);
    }

    /* –í —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ ‚Äî —Å—Ç—Ä–æ–≥–∏–π –±–µ–ª—ã–π */
    body.dark-theme #user-display-name {
      color: #ffffff !important;
    }

     body.dark-theme #user-display-name.text-muted {
      color: #ffffff !important;
    }


     /* –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –±–µ–∑ —Ç–µ–Ω–∏ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
      body.dark-theme .filter-panel,
      body.dark-theme .filters-wrapper {
        box-shadow: none !important;
      }

      /* –û–±—â–∏–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è –¥–ª—è –≤—ã–ø–∞–¥–∞—à–∫–∏ */
      .bootstrap-select .dropdown-menu {
        border-radius: 16px !important;
      }

      /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞: –±–µ–ª—ã–π —Ñ–æ–Ω –∏ —Ç–æ–Ω–∫–∞—è —Å–µ—Ä–∞—è —Ä–∞–º–∫–∞ */
      body:not(.dark-theme) .bootstrap-select .dropdown-menu {
        background: #ffffff !important;
        border: 1px solid #dee2e6 !important;
        box-shadow: none !important;
      }

      /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞: —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω –∏ —Ä–∞–º–∫–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π */
      body.dark-theme .bootstrap-select .dropdown-menu {
        background: var(--card-bg-color) !important;
        border: 1px solid var(--card-border-color) !important;
        box-shadow: none !important;
      }

      /* ‚Äî –°–∫—Ä—É–≥–ª—è–µ–º –∏ —É–±–∏—Ä–∞–µ–º –±–µ–ª—ã–π —Ñ–æ–Ω —É –∫–Ω–æ–ø–∫–∏ –≤—ã–ø–∞–¥–∞—à–∫–∏ ‚Äî */
.bootstrap-select .dropdown-toggle {
  border-radius: 20px !important;
  box-shadow: none !important;
}

/* ‚Äî —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ ‚Äî */
body:not(.dark-theme) .bootstrap-select .dropdown-toggle {
  background-color: #fff !important;
  border: 1px solid #dee2e6 !important;
  color: #343a40 !important;
}

/* ‚Äî —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ ‚Äî */
body.dark-theme .bootstrap-select .dropdown-toggle {
  background-color: var(--card-bg-color) !important;
  border: 1px solid var(--card-border-color) !important;
  color: var(--text-color) !important;
}

/* ‚Äî —á—É—Ç—å —Å–∫—Ä—É–≥–ª—è–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫—É ‚Äî */
.bootstrap-select .dropdown-toggle .filter-option-inner-inner {
  border-radius: 20px !important;
}

      /* –¢–µ–∫—Å—Ç –ø—É–Ω–∫—Ç–æ–≤ */
      .bootstrap-select .dropdown-item {
        border-radius: 12px;             /* —á—É—Ç—å —Å–∫—Ä—É–≥–ª–∏—Ç—å —Å–∞–º–∏ –ø—É–Ω–∫—Ç—ã */
        transition: background .2s ease;
      }

      /* –¶–≤–µ—Ç–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
      body:not(.dark-theme) .bootstrap-select .dropdown-item {
        color: #343a40;
      }
      body:not(.dark-theme) .bootstrap-select .dropdown-item:hover,
      body:not(.dark-theme) .bootstrap-select .dropdown-item.active {
        background-color: #f1f1f1 !important;
      }

      /* –¶–≤–µ—Ç–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
      body.dark-theme .bootstrap-select .dropdown-item {
        color: #e5e5e5;
      }
      body.dark-theme .bootstrap-select .dropdown-item:hover,
      body.dark-theme .bootstrap-select .dropdown-item.active {
        background-color: rgba(255,255,255,0.1) !important;
      }

      .break-overdue {
        color: #dc3545 !important; /* Bootstrap red */
        font-weight: bold;
        animation: pulse 1s infinite;
      }
      .break-overdue .employee-name,
      .break-overdue .text-muted {
        color: #dc3545 !important; /* Bootstrap red */
        font-weight: bold;
      }
      .body.dark-theme .break-overdue {
        color: #dc3545 !important; /* Bootstrap red */
        font-weight: bold;
        animation: pulse 1s infinite !important;
      }
      body.dark-theme .break-overdue .employee-name,
      body.dark-theme .break-overdue .text-muted {
        color: #dc3545 !important;
      }
      .employee-item.king .employee-name {
        color: gold !important;
        font-weight: bold;
      }

      .employee-item.pink-name .employee-name {
      color: hotpink !important;
      }

      .pink-name {
      color: hotpink !important;
      }

      .employee-name {
        transition: transform 0.3s ease, color 0.3 ease;
      }

      .employee-name:hover {
        transition: scale(1.1);
        color: #ff4500;
        cursor: pointer;
      }

      .aircall-status {
        color: green !important;
      }
      /* —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–π –∂–µ —Ä–∞–∑–º–µ—Ä –∏ –æ—Ç—Å—Ç—É–ø—ã, –∫–∞–∫ —É –æ–±—ã—á–Ω—ã—Ö .filter-dropdown */
    .filters-wrapper .bootstrap-select .dropdown-toggle {
      box-sizing: border-box !important;
      height: 40px !important;      /* —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å height .filter-dropdown */
      padding: 8px 16px !important; /* —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å padding .filter-dropdown */
      background: var(--card-bg-color) !important;
      border: 1px solid var(--card-border-color) !important;
      border-radius: 20px !important;
    }
    
    /* –°–±—Ä–æ—Å —Ñ–æ–Ω–æ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–µ–ª–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ —Ç–∞–±–ª–∏—Ü—ã –≤ dark-theme */
body.dark-theme .shift-summary-grid td:nth-child(2),
body.dark-theme .shift-summary-grid th:nth-child(2) {
  background-color: transparent !important;
  color: #ffffff !important;
}

/* –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ —è—á–µ–µ–∫ –µ—â—ë –µ—Å—Ç—å span-—ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ñ–æ–Ω–æ–º, —Å–±—Ä–æ—Å–∏–º –∏ —É –Ω–∏—Ö */
body.dark-theme .shift-summary-grid td:nth-child(2) span {
  background-color: transparent !important;
  color: #ffffff !important;
}

/* —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî –æ–±—â–∏–π —Ñ–ª–µ–∫—Å —Å–æ –≤—Å–µ–º–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è–º–∏ */
.toggle-container {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;      /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–µ–∫—Å—Ç–æ–º –∏ —Å–ª–∞–π–¥–µ—Ä–æ–º */
  margin-right: 1rem;
}

/* –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞/–æ—Ç—Å—Ç—É–ø —É –ª–µ–π–±–ª–∞ */
.toggle-container .toggle-label {
  font-size: 0.9rem;
  color: var(--text-color);
}

/* —Å–∞–º ¬´—Å–ª–∞–π–¥–µ—Ä¬ª */
.dnd-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}
.dnd-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.dnd-switch .slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #ccc;
  transition: background-color 0.3s;
  border-radius: 24px;
}
.dnd-switch .slider:before {
  content: "";
  position: absolute;
  height: 18px; width: 18px;
  left: 3px; bottom: 3px;
  background-color: white;
  transition: transform 0.3s;
  border-radius: 50%;
}

/* —Å–æ—Å—Ç–æ—è–Ω–∏–µ ¬´–≤–∫–ª—é—á–µ–Ω–æ¬ª */
.dnd-switch input:checked + .slider {
  background-color: #007bff;
}
.dnd-switch input:checked + .slider:before {
  transform: translateX(26px);
}
/* –î–µ–ª–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–ª–æ—á–Ω—ã–º flex-—ç–ª–µ–º–µ–Ω—Ç–æ–º –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
/* 1) –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è ‚Äî flex-—Ü–µ–Ω—Ç—Ä */
#dnd-toggle-container {
  display: inline-flex !important;
  align-items: center !important;
}

/* Override –ø–æ–ª–æ–∂–µ–Ω–∏—è –∫—Ä—É–∂–∫–∞ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º —á–µ–∫–±–æ–∫—Å–µ */
#dnd-toggle-container .dnd-switch input:checked + .slider:before {
  bottom: 3px !important;            /* —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç –Ω–∏–∑–∞ */
  transform: translateX(26px) !important; /* —Å–¥–≤–∏–≥–∞–µ–º –≤–ø—Ä–∞–≤–æ */
}

/* –ù–µ –¥–∞—ë–º —Ç—Ä–µ–∫—É ¬´–ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞—Ç—å¬ª */
#dnd-toggle-container .dnd-switch input:checked + .slider {
  top: 0 !important;
  bottom: 0 !important;
}

/* –í–º–µ—Å—Ç–æ position:relative+top ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–Ω–∏–º–µ–º/–æ–ø—É—Å—Ç–∏–º –≤–µ—Å—å –ª–µ–π–±–ª —á—É—Ç—å –Ω–∏–∂–µ */
#dnd-toggle-container .dnd-switch {
  /* —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π —Å 1px‚Äì3px, –ø–æ–∫–∞ –Ω–µ –ª—è–∂–µ—Ç —Ç–æ—á–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
  margin-top: 8px !important;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}
/* –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ–º –≤–µ—à–∞—Ç—å –Ω–∞ –∏–∫–æ–Ω–∫—É */
.rotating {
  animation: spin 1s linear infinite;
}



      @keyframes pulse {
        0% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.6;
          transform: scale(1.05);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }
    </style>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script>
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyAHyxC12UaO6QU_nCiWFnegul1Vix5skm8",
        authDomain: "shldashboard.firebaseapp.com",
        projectId: "shldashboard",
        storageBucket: "shldashboard.firebasestorage.app",
        messagingSenderId: "362566153595",
        appId: "1:362566153595:web:ee35c2588bd0f798e6f9de"
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();

      const brbAlertSent = {};
      const BREAK_NOTIF_KEY = 'overdueBreakNotified';
      let overdueBreakNotified = JSON.parse(localStorage.getItem(BREAK_NOTIF_KEY) || '{}');
      const brbOverdueNotified = {};
      const TRANSITIONS_API = 'https://script.google.com/macros/s/AKfycbwlp0Gsq8sVkI28nFW1TZvW_immH6PLrXejAeexj-48MhFtV7_uQ8SVjNi13RUfv_uj/exec?json=1';



async function fetchStatusChanges() {
  try {
    const res = await fetch(TRANSFERS_API);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –≤–∏–¥–∞
    // { Timestamp: "...", Name: "...", FromPlatform: "...", ToPlatform: "...", Duration: "..." }
    const raw = await res.json();
    // –ø—Ä–∏–≤–æ–¥–∏–º –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É
    window.transfersData = raw
      .map(item => ({
        name:         item.Name,
        fromPlatform: item.FromPlatform,
        toPlatform:   item.ToPlatform,
        duration:     item.Duration,
        timestamp:    item.Timestamp
      }))
      // –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–µ–ø–æ–ª–Ω—ã–µ –∑–∞–ø–∏—Å–∏
      .filter(t => t.name && t.fromPlatform && t.toPlatform);
    console.log('transfersData', window.transfersData);
  } catch (err) {
    console.error('–û—à–∏–±–∫–∞ fetchStatusChanges:', err);
    window.transfersData = [];
  }
}


      // –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö email
      const allowedEmails = [
        "mikhail.garayev@wolt.com",
        "elshan.tahmazov@wolt.com",
        "inara.mammadzada@wolt.com",
        "mayya.mirzayeva@wolt.com",
        "mikayil.alizada@wolt.com",
        "pasha.chiragov@wolt.com",
        "rahim.mammadov@wolt.com",
        "toghrul.mirzali@wolt.com",
        "amaliya.rizvanova@wolt.com",
        "anar.mikayilov@wolt.com",
        "arif.guliyev@wolt.com",
        "farid.hajiyev@wolt.com",
        "naziya.orujova@wolt.com",
        "rafig.huseynov@wolt.com",
        "sama.akbarzadegan@wolt.com",
        "mursal.askarov@wolt.com"
      ];

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äì –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –µ–≥–æ email –Ω–µ —Ä–∞–∑—Ä–µ—à—ë–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ login.html
      auth.onAuthStateChanged((user) => {
        if (!user || !allowedEmails.includes(user.email)) {
          window.location.replace("login.html");
        } else {
          // –ï—Å–ª–∏ –≤—Å–µ –æ–∫, –≤—ã–≤–æ–¥–∏–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å hidden
          document.getElementById("user-display-name").textContent =
            user.displayName || user.email;
          document.body.classList.remove("hidden");
        }
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Log Out
      document.addEventListener("DOMContentLoaded", () => {
        const logoutBtn = document.getElementById("logout-btn");
        logoutBtn.addEventListener("click", () => {
          auth.signOut();
        });
      });
    </script>
  </head>
  <body class="hidden">
      <!-- Header -->
      <header class="dashboard-header">
  <!-- 1) –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –±—É—Ä–≥–µ—Ä + –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="d-flex align-items-center gap-3">
    <div class="hamburger-menu" id="hamburger-menu">
      <span style="font-size: 24px; cursor: pointer;">‚ò∞</span>
    </div>
    <h1 class="mb-0" style="font-size: 1.3rem;">
      Support Monitoring Dashboard
    </h1>
  </div>

  <!-- 2) –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å: –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ + —Ç–∞–π–º–µ—Ä -->
  <div class="d-flex align-items-center flex-wrap header-gap flex-grow-1 justify-content-end">
    <!-- Do Not Disturb -->
    <div class="toggle-container" id="dnd-toggle-container">
      <span class="toggle-label">Do not Disturb</span>
      <label class="dnd-switch">
        <input type="checkbox" id="dnd-toggle" />
        <span class="slider"></span>
      </label>
    </div>

    <!-- Bell -->
    <div id="notification-bell" style="position:relative; cursor:pointer; margin-right:1rem;">
      <img
        src="https://www.svgrepo.com/show/525245/bell-off.svg"
        alt="Notifications"
        title="Notifications"
        style="width:24px; height:24px;"
      />
      <span
        id="notification-count"
        style="position:absolute; top:-4px; right:-4px; background:#dc3545;
               color:#fff; border-radius:50%; padding:2px 6px; font-size:0.7rem;
               display:none;"
      >0</span>
      <div id="notifications-panel" class="notifications-dropdown"></div>
    </div>
    <!-- Notifications dropdown panel -->

    <!-- Theme toggle -->
    <div class="d-flex align-items-center gap-2">
      <span>Theme:</span>
      <label class="theme-switch mb-0" style="margin-left: 8px;">
        <input type="checkbox" id="theme-checkbox" />
        <span class="slider"></span>
      </label>
    </div>

    <!-- Refresh -->
    <div class="refresh-section d-flex align-items-center gap-2 mr-3">
      <span id="timer-label">
        Refresh in: <span id="countdown">15</span>s
      </span>
      <img
        id="refresh-icon"
        src="https://www.svgrepo.com/show/168563/refresh.svg"
        alt="Refresh"
        title="Refresh now"
        style="width:24px; height:24px; cursor:pointer;"
        onclick="refreshNow()"
      />
    </div>
  </div>

  <!-- 3) –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –∏–º—è + logout -->
  <div class="d-flex align-items-center gap-2">
    <span id="user-display-name" class="small text-muted"></span>
    <img
      id="logout-btn"
      src="./log-out.svg"
      alt="Log Out"
      title="Log Out"
      style="width:22px; height:22px; cursor:pointer; margin-left:8px;"
    />
  </div>
</header>

    <!-- Grid container -->
    <div class="dashboard-layout">

      <!-- Sidebar -->
      <aside class="sidebar">
        <div id="sidebar">
          <!-- –Ω–æ–≤—ã–π close-btn —Å SVG-—Å—Ç—Ä–µ–ª–∫–æ–π -->
          <div class="close-btn" id="sidebar-close" title="Close sidebar">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24" height="24"
              viewBox="0 0 16 16"
              fill="currentColor"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 
                  5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 
                  1 0-.708l6-6a.5.5 0 0 1 .708 0z"
              />
            </svg>
          </div>
          <a href="https://mikhailgarayev.github.io/shldashboard/shifts.html">üóìÔ∏è Today`s Shifts by Platform</a>
          <a href="https://script.google.com/macros/s/AKfycbyMdv_AP0p3tTMUZoeKEQhw8YFI9upxx6P0oAAI5pO1s-PbcCyBkKIcbGasvi-dpVAb/exec">üìà Allocation stats</a>
          <a href="https://my.yigim.az/login" target="_blank">üìä YIGIM Dashboard</a>
          <a href="https://wolt-prod.datadoghq.eu/dashboard/zpt-745-5da/city-health-dashboard-template-24h-aze?fromUser=false&refresh_mode=sliding&tpl_var_area_name%5B0%5D=baku&view=spans&from_ts=1745505436253&to_ts=1745507236253&live=true" target="_blank">üìà Datadog Dashboard</a>
          <a href="https://wolt-prod.datadoghq.eu/dashboard/y66-xdi-4xy/payments---authorizations?fromUser=false&fullscreen_end_ts=1745567771563&fullscreen_paused=false&fullscreen_refresh_mode=sliding&fullscreen_section=overview&fullscreen_start_ts=1745566871563&fullscreen_widget=2003408243236226&refresh_mode=sliding&view=spans&from_ts=1745556684337&to_ts=1745560284337&live=true" target="_blank">üìà Datadog Payment Dashboard</a>
          <a href="https://ops.wolt.com/city-states?country=AZE" target="_blank">üèôÔ∏è City States</a>
          <a href="https://ops.wolt.com/city-tools" target="_blank">üõ†Ô∏è City Tools</a>
          <a href="https://ops.wolt.com/support/converse/admin/users" target="_blank">üß≠ Converse Admin Panel</a>
          <a href="https://wo.lt/tracker" target="_blank">‚öôÔ∏è Away employees tracker</a>
          <a href="https://dashboard.aircall.io" target="_blank">üìû Aircall Dashboard</a>
          <a href="https://app.getguru.com/dashboard" target="_blank">üìö Guru</a>
          <a href="https://wo.lt/dashboard" target="_blank">üì© Video dashboard</a>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Filters -->
     <!-- –¶–µ–Ω—Ç—Ä: —Ñ–∏–ª—å—Ç—Ä—ã -->
     <div class="filters-wrapper d-flex flex-wrap align-items-center flex-grow-1 justify-content-center header-gap">
      <!-- –°—Ç–∞—Ç—É—Å -->
      <select id="status-filter" class="filter-dropdown">
        <option value="both">Status</option>
        <option value="active">Active</option>
        <option value="away">Away</option>
      </select>
    
      <!-- –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã (bootstrap-select) -->
      <select
        id="platform-dropdown"
        class="selectpicker"
        multiple
        data-live-search="true"
        title="Platform"
        data-width="auto"
        data-style="filter-dropdown"
      >
        <option value="all" selected>All platforms</option>
        <option value="CS">CS</option>
        <option value="CS/Post order">CS/Post order</option>
        <option value="PSR">PSR</option>
        <option value="SiMo">SiMo</option>
        <option value="Aircall">Aircall</option>
        <option value="Venue">Venue</option>
        <option value="Trainee">Trainee</option>
        <option value="ST">ST</option>
      </select>
    
      <!-- Reallocate —Ñ–∏–ª—å—Ç—Ä -->
      <select id="realloc-filter" class="filter-dropdown">
        <option value="all">Reallocate: All</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>
    
      <!-- Language —Ñ–∏–ª—å—Ç—Ä -->
      <select id="lang-filter" class="filter-dropdown">
        <option value="all">Language: All</option>
        <option value="two">Bilingual</option>
        <option value="three">Trilingual</option>
      </select>
    
      <!-- Breaks —Ñ–∏–ª—å—Ç—Ä -->
      <select id="break-filter" class="filter-dropdown">
        <option value="upcoming">Breaks: Upcoming</option>
        <option value="all">Breaks: All</option>
      </select>
    
      <!-- –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ -->
      <input
        type="text"
        id="employee-search"
        placeholder="Search..."
        class="search-input"
      />
    
      <!-- –ù–æ–≤—ã–π —Å–µ–ª–µ–∫—Ç –¥–ª—è Find Candidate -->
      <select id="target-platform" class="filter-dropdown">
        <option value="">‚Üí Reallocate to..</option>
      </select>
      <button id="find-candidate" class="btn btn-outline-primary">Find candidate</button>
      <div id="candidate-result" style="margin:1rem 0;"></div>
    </div>

        <!-- Stats Cards -->
        <!-- 1) –û–±—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (On shift now, Should be, Not here, WNATS, Weather) -->
        <div id="summary-general"></div>

        <!-- 2) –¢–æ–ª—å–∫–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—ã (CS, CS/Post Order, PSR, SiMo, Aircall, Venue, ST) -->
        <div id="summary-platforms"></div>

        <!-- 3) –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ platform-card -->
        <div id="platforms-container" class="platforms-row"></div>

      </main>

      <!-- Right Panel: Breaks & Shift-Overs -->
      <aside class="right-panel">
        <div id="shift-overs-section" class="alert-card"><h2>‚è≥ Upcoming Shift-Overs</h2><div id="shift-overs-app" class="alert-content">Loading...</div></div>
        <div id="breaks-section" class="alert-card"><h2>‚è∞ Breaks</h2><div id="breaks-app" class="alert-content">Loading...</div></div>
      </aside>

    </div> <!-- /.dashboard-layout -->

    <!-- Modals -->
  </div>
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
  <div id="modal-overlay"></div>
  <div
    id="employee-modal">
    <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px 20px 0 20px;">
      <div style="display: flex; align-items: center;">
        <img 
        id="modal-emp-avatar" 
        src="https://i.ibb.co/YrbxqCn/favicon.jpg" 
        alt="Avatar" 
        style="width: 60px; height: 60px; border-radius: 50%; margin-right: 15px;"
      />
        <div>
          <h5 id="modal-emp-name" style="margin: 0; font-weight: 600;">Employee Name</h5>
          <small id="modal-emp-email" style="color: #888;">employee.email@wolt.com</small>
        </div>
      </div>
      <span class="close-btn" id="modal-close" style="cursor: pointer; font-size: 24px; color: #999;">&times;</span>
    </div>
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div style="padding: 15px 20px 0 20px; text-align: left;">
      <div style="margin-bottom: 10px;">
        <strong>Role:</strong>
        <span id="modal-emp-role">Support Associate</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Prime platform:</strong>
        <span id="modal-emp-prime">CS</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Preferred platform:</strong>
        <span id="modal-emp-pref">PSR</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Can reallocate?:</strong>
        <span id="modal-emp-realloc">Yes</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Language:</strong>
        <span id="modal-emp-languages">AZ RUGB</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Capacity:</strong>
        <span id="modal-emp-capacity">‚Äî</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Shift:</strong>
        <span id="modal-emp-shift">‚Äî</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Break:</strong>
        <span id="modal-emp-break">‚Äî</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Platform changes today:</strong>
        <span id="modal-platform-count">‚Äì</span>
      </div>
      <ul id="modal-platform-list" style="margin-left: 20px; font-size:0.9rem;"></ul>

    </div>
    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div style="padding: 20px; text-align: right;">
      <button id="modal-inbox-link" class="btn btn-primary" style="margin-right: 10px;">Open Inbox</button>
      <button id="modal-admin-link" class="btn btn-outline-primary">Admin Panel</button>
    </div>
  </div>


    <!-- –°–µ–∫—Ü–∏—è —Å –¥–≤—É–º—è –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏: Shift-Overs –∏ Breaks -->
    <div
  id="alerts-section"
  class="d-flex flex-wrap gap-4 justify-content-center my-4 px-3"
  style="align-items: stretch;"
>

    <div
      class="modal fade"
      id="candidateModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="candidateModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="candidateModalLabel">Recommended candidate</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="candidateModalBody">
            <!-- —Å—é–¥–∞ JS –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- ================================================== -->
      
      
      <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º jQuery, Bootstrap JS –∏ Bootstrap-Select JS -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>
      <script>
        // ========== Do Not Disturb ==========
        let doNotDisturb = localStorage.getItem('doNotDisturb') === 'true';

        function setDoNotDisturb(value) {
          doNotDisturb = value;
          localStorage.setItem('doNotDisturb', value);
        }

        // —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
        // –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø–∞–Ω–µ–ª–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const notificationQueue = [];


        // -------------- begin shift‚Äêbadge config --------------

        // map –ø–ª–∞—Ç—Ñ–æ—Ä–º ‚Üí bootstrap‚Äê–∫–ª–∞—Å—Å –±–µ–π–¥–∂–∞

        // –≤–º–µ—Å—Ç–æ platformBadgeClasses
        const shiftBadgeClasses = {
        "CS":      "badge-primary",
        "CS PO":   "badge-danger",
        "PSR":     "badge-success",
        "Simo":    "badge-info",
        "Aircall": "badge-warning",
        "Venue":   "badge-warning",
        "Trainee": "badge-light text-dark",
        "ST":      "badge-dark",
        "SUMO":    "badge-secondary",
      };

      const shiftDisplayNames = {
      "CS/Post order": "CS PO",
      "CS/Post Order": "CS PO",
      "CS / Post order": "CS PO",
      "CS / Post Order": "CS PO",
      "Special task": "ST",
      "SiMo/Aircall": "SUMO",
    };
        // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤–∏–¥–∞ "06:00-15:00" –¥–ª—è –∏–º–µ–Ω–∏
        // –≤–º–µ—Å—Ç–æ "getEmployeeShift" ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–º–µ–Ω—ã, –∞ –Ω–µ –≤—Ä–µ–º—è
        function getEmployeeShiftName(empName) {
          const rec = window.shiftsQuinyxData.find(r =>
            r.name.toLowerCase() === empName.toLowerCase()
          );
          return rec?.platform || "";
        }


        // -------------- end shift‚Äêbadge config --------------

        // ===============================
        // WEATHER SECTION WITH CACHING & EMOJI
        const OPENWEATHER_API_KEY = "f97220cfb6bcefa391405990e7b9825d";
        const STORAGE_KEY = "notifiedEmptyPlatforms";

        let notifiedEmpty = new Set(
  JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]")
);

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–≥–æ–¥—É –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –∏ –∫–ª–∞–¥—ë—Ç
 * —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã.
 *
 * @param {string} city       ‚Äî —Å—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞ "Ganja,AZ"
 * @param {string} tempElemId ‚Äî id –±–ª–æ–∫–∞ –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "temp-ganja")
 * @param {string} windElemId ‚Äî id –±–ª–æ–∫–∞ –¥–ª—è –≤–µ—Ç—Ä–∞       (–Ω–∞–ø—Ä–∏–º–µ—Ä "wind-ganja")
 */
async function fetchWeatherFor(city, tempElemId, windElemId) {
  const cacheKey     = city + "_weatherData";
  const cacheTimeKey = city + "_weatherTimestamp";
  const now          = Date.now();
  const cacheTTL     = 15 * 60 * 1000; // 15 –º–∏–Ω—É—Ç

  let data;
  const rawData      = localStorage.getItem(cacheKey);
  const rawTs        = localStorage.getItem(cacheTimeKey);

  if (rawData && rawTs && now - rawTs < cacheTTL) {
    data = JSON.parse(rawData);
  } else {
    const url = `https://api.openweathermap.org/data/2.5/weather` +
                `?q=${encodeURIComponent(city)}` +
                `&units=metric&appid=${OPENWEATHER_API_KEY}`;
    const res = await fetch(url);
    if (!res.ok) {
      console.error("Weather API error for", city, res.statusText);
      return;
    }
    data = await res.json();
    localStorage.setItem(cacheKey, JSON.stringify(data));
    localStorage.setItem(cacheTimeKey, now);
  }

  // Build display strings
  const tempRaw   = data.main?.temp;
  const windRaw   = data.wind?.speed;
  const emoji     = (() => {
    const cond = data.weather?.[0]?.main;
    switch(cond){
      case "Clear":       return "‚òÄÔ∏è";
      case "Clouds":      return "‚òÅÔ∏è";
      case "Rain": 
      case "Drizzle":     return "üåßÔ∏è";
      case "Thunderstorm":return "‚õàÔ∏è";
      case "Snow":        return "‚ùÑÔ∏è";
      default:            return "";
    }
  })();

  const tempText = (tempRaw != null)
    ? `${Math.round(tempRaw)} ¬∞C ${emoji}`
    : "-- ¬∞C";
  const windText = (typeof windRaw === "number")
    ? `${Math.round(windRaw*10)/10} m/s`
    : "-- m/s";

  // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ DOM
  document.getElementById(tempElemId).textContent = tempText;
  document.getElementById(windElemId).textContent = windText;
}

        
        // ===============================

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º
        const platformInfo = {
          "CS":
            "Click on the link to open the CS platform.\nClick on employee name to open their profile.",
          "CS/Post order":
            "Click on the link to open the CS PO AZE platform.\nClick on employee name to open their profile.",
          PSR: "Click on the link to open the PSR platform.\nClick on employee name to open their profile.",
          SiMo: "Click on the link to open the Support Inbox.\nClick on employee name to open their profile.",
          Aircall:
            "Click on the link to open the CS platform.\nClick on employee name to open their profile.\n You can see employee's status in the Aircall.",
          Venue:
            "Click on the link to open the Venue platform.\nClick on employee name to open their profile.",
          Trainee: "Click on employee name to open their profile.",
          ST: "Click on employee name to open their profile."
        };

        let fetchedData = null;
        let currentSearchTerm = "";
        let currentStatusFilter = "both";
        let currentPlatformFilter = ["all"];
        let currentReallocFilter = "all";
        let currentLangFilter = "all";
        let currentBreakFilter = "upcoming";

        const SPREADSHEET_ID = "1dICKOxxz9R3x8MY3FKQ9I-IwR9fBUDfMOT9PFDLloAE";
        const SHIFT_RANGE = "list1!AT5:BH47";
        const RANGE = "list1!A1:BJ100";
        const RESPONSIBLES_RANGE = "responsiblepeople!A:B";
        const BREAKS_RANGE = "prebreaks!A1:D80";
        const SHIFT_QUINYX_RANGE = "shiftsquinyx!B3:C"; 

        let employeeData = {};

        const platforms = [
          {
            name: "CS",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=6643245bfadf62c6edc28feb",
            colIndexNames: 3,
            colIndexData: 4,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "CS/Post order",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=664324a0510ac011feaa798c",
            colIndexNames: 5,
            colIndexData: 6,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "PSR",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=6567a44af7d470550b11dc68",
            colIndexNames: 7,
            colIndexData: 8,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "SiMo",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=6668088fc6d870f3cfd61653",
            colIndexNames: 9,
            colIndexData: 10,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "Aircall",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=671a26a2a5b9ae4a2ca603fb",
            colIndexNames: 11,
            colIndexData: 12,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "Venue",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=666807fc28b3f1231948f407",
            colIndexNames: 13,
            colIndexData: 14,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "Trainee",
            url: "https://wolt.com/",
            colIndexNames: 15,
            colIndexData: 16,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "ST",
            url: "https://wolt.com/",
            colIndexNames: 17,
            colIndexData: 18,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          }
        ];

        let aircallActive = [];
        let aircallAway = [];

        function logDebug(message) {
          console.log(message);
        }

        async function fetchSheetData(range) {
          try {
            const res = await fetch("https://sheets-proxy.mikhail-garayev.workers.dev", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                secret: "superWoltKey42",
                range: range
              })
            });
            const data = await res.json();
            return data.values;
          } catch (e) {
            console.error("Sheets proxy error:", e);
            return null;
          }
        }

        async function fetchEmployeeList() {
  // —Ç–µ–ø–µ—Ä—å A‚ÄìH: A: Name, B: ID, C: CanReallocate, D: Prime, E: Pref, F: Languages, G: Capacity, H: StartDate
  const data = await fetchSheetData("emplist!A1:H");
  if (!data || data.length < 2) return;

  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    const empName           = row[0]?.trim();
    if (!empName) continue;

    const empId             = row[1]?.trim() || "";
    const canRealloc        = row[2]?.trim() || "No";
    const primePlatform     = row[3]?.trim() || "N/A";
    const preferredPlatform = row[4]?.trim() || "N/A";
    const languages         = row[5]?.trim() || "";
    const capacity          = row[6]?.trim() || "";
    const startDateRaw      = row[7]?.trim() || "";

    employeeData[empName] = {
      id:            empId,
      canReallocate: canRealloc,
      prime:         primePlatform,
      pref:          preferredPlatform,
      languages:     languages,
      capacity:      capacity,
      startDate:     startDateRaw
    };
  }
}


        function generateInboxLink(empId) {
          return (
            "https://ops.wolt.com/support/converse/users/conversations?assigneeIds=" +
            encodeURIComponent(empId)
          );
        }

        function generateAdminLink(empId) {
          return (
            "https://ops.wolt.com/support/converse/admin/users?userId=" +
            encodeURIComponent(empId)
          );
        }

        // –í—Å—Ç–∞–≤—å—Ç–µ –≥–¥–µ-–Ω–∏–±—É–¥—å —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ —É—Ç–∏–ª–∏—Ç–∞–º–∏
function normalize(str) {
  return String(str || "")
    .toLowerCase()
    .replace(/[\s\/-]+/g, ""); // —É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã, –∫–æ—Å—É—é —á–µ—Ä—Ç—É, –¥–µ—Ñ–∏—Å
}
// –ø–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ "DD.MM.YYYY HH:mm:ss" ‚Üí JS Date
// –ø–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ "DD.MM.YYYY HH:mm:ss" ‚Üí JS Date,
// –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–ª–∏ –Ω–µ–ø–æ–ª–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ –ø–∞–¥–µ–Ω–∏—è
function parseDDMMYYYY(str) {
  if (typeof str !== 'string') {
    console.warn('parseDDMMYYYY got non-string:', str);
    return new Date(str);           // –ø–æ–ø—Ä–æ–±—É–µ–º native-–ø–∞—Ä—Å–µ—Ä
  }

  // —Ä–∞–∑–¥–µ–ª—è–µ–º –ø–æ –ª—é–±–æ–º—É —á–∏—Å–ª—É –ø—Ä–æ–±–µ–ª–æ–≤
  const parts = str.trim().split(/\s+/);
  if (parts.length < 2) {
    // –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ ‚Äî –ø–æ–ø—ã—Ç–∫–∞ native-–ø–∞—Ä—Å–µ—Ä–∞
    return new Date(str);
  }
  const [datePart, timePart] = parts;

  const dp = datePart.split('.');
  if (dp.length !== 3) {
    console.warn('parseDDMMYYYY got bad datePart:', datePart);
    return new Date(str);
  }
  let [day, month, year] = dp;

  // –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –ø–æ –¥–≤–µ —Ü–∏—Ñ—Ä—ã
  day   = String(day).padStart(2,'0');
  month = String(month).padStart(2,'0');

  // —Ñ–æ—Ä–º–∏—Ä—É–µ–º ISO-—Å—Ç—Ä–æ–∫—É
  const iso = `${year}-${month}-${day}T${timePart}`;
  const d = new Date(iso);
  if (isNaN(d.getTime())) {
    console.warn('parseDDMMYYYY failed to parse:', iso);
    return new Date(str);
  }
  return d;
}



async function openEmployeeModal(empName) {
  const info = employeeData[empName];
  if (!info) {
    console.warn("–î–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã: " + empName);
    return;
  }

  // 1) –°–º–µ–Ω–∞
  const rec = window.shiftsQuinyxData.find(
    r => r.name.toLowerCase() === empName.toLowerCase()
  ) || {};
  const shiftName = rec.platform || "‚Äî";
  const shiftTime = rec.shift    || "‚Äî";
  document.getElementById("modal-emp-shift").textContent =
    `${shiftName} (${shiftTime})`;

  // 2) –ü–µ—Ä–µ—Ä—ã–≤
  let breakTime = "‚Äî";
  if (Array.isArray(window.allBreaksData)) {
    const br = window.allBreaksData.find(b =>
      b.Name?.trim().toLowerCase() === empName.trim().toLowerCase()
    );
    if (br) breakTime = br["Break Time"] || "‚Äî";
  }
  document.getElementById("modal-emp-break").textContent = breakTime;

  // 3) –û–±—â–∞—è –∏–Ω—Ñ–∞
  const parts = empName.trim().split(" ");
  const email = parts.length >= 2
    ? `${parts[0].toLowerCase()}.${parts[1].toLowerCase()}@wolt.com`
    : `${parts[0].toLowerCase()}@wolt.com`;

  document.getElementById("modal-emp-name").textContent      = empName;
  document.getElementById("modal-emp-email").textContent     = email;
  document.getElementById("modal-emp-realloc").textContent   = info.canReallocate || "N/A";
  document.getElementById("modal-emp-prime").textContent     = info.prime         || "N/A";
  document.getElementById("modal-emp-pref").textContent      = info.pref          || "N/A";
  document.getElementById("modal-emp-languages").textContent = info.languages     || "N/A";
  document.getElementById("modal-emp-capacity").textContent  = info.capacity      || "N/A";

  document.getElementById("modal-inbox-link").onclick = () => {
    window.open(generateInboxLink(info.id), "_blank");
  };
  document.getElementById("modal-admin-link").onclick = () => {
    window.open(generateAdminLink(info.id), "_blank");
  };

  // 4) –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
  const countEl = document.getElementById("modal-platform-count");
  const listEl  = document.getElementById("modal-platform-list");
  countEl.textContent = "‚Ä¶";
  listEl.innerHTML    = "<li>Loading‚Ä¶</li>";

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Å—Ä–∞–∑—É
  document.getElementById("modal-overlay").classList.add("show");
  document.getElementById("employee-modal").classList.add("show");

  try {
    // **–í–∞–∂–Ω–æ**: –ø–µ—Ä–µ–¥–∞—ë–º empName –≤ –∑–∞–ø—Ä–æ—Å
    const url = `${TRANSITIONS_API}&name=${encodeURIComponent(empName)}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(res.statusText);
    const moves = await res.json(); // —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–∞–Ω–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

    countEl.textContent = moves.length;
    if (moves.length > 0) {
      listEl.innerHTML = moves.map(r => {
        const [, toPlat, , fromStr, toStr, durStr] = r;
        return `
          <li>
            <strong>${fromStr}</strong> ‚Üí <strong>${toStr}</strong><br>
            To: <em>${toPlat}</em> (Duration ${durStr})
          </li>
        `;
      }).join("");
    } else {
      listEl.innerHTML = "<li>No platform changes today</li>";
    }
  } catch (err) {
    console.error("Error loading transitions:", err);
    countEl.textContent = "‚Äî";
    listEl.innerHTML    = `<li class="text-danger">Error loading data</li>`;
  }
}



        function closeEmployeeModal() {
          document.getElementById("employee-modal").classList.remove("show");
          document.getElementById("modal-overlay").classList.remove("show");
        }


        async function getAircallUserId(email) {
          try {
            const res = await fetch("https://aircall-proxy.mikhail-garayev.workers.dev", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                secret: "superWoltKey42",
                email: email
              })
            });
        
            if (!res.ok) {
              logDebug(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ Aircall: ${res.statusText}`);
              return null;
            }
        
            const data = await res.json();
        
            if (!data?.user?.id) {
              logDebug("Aircall API –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç");
              return null;
            }
        
            logDebug(`–ü–æ–ª—É—á–µ–Ω Aircall ID: ${data.user.id}`);
            return data.user.id;
        
          } catch (err) {
            logDebug("–û—à–∏–±–∫–∞ getAircallUserId —á–µ—Ä–µ–∑ Worker: " + err.message);
            return null;
          }
        }


        async function getAircallAvailability(userId) {
          if (!userId) {
            logDebug("getAircallAvailability: userId –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω");
            return "No ID";
          }
        
          try {
            const res = await fetch("https://aircall-proxy.mikhail-garayev.workers.dev", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                secret: "superWoltKey42",
                userId: userId,
                action: "availability"
              })
            });
        
            if (!res.ok) {
              logDebug("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ Worker: " + res.statusText);
              return "Error";
            }
        
            const data = await res.json();
        
            const status =
              data?.user_availability?.availability_status || data?.availability;
        
            logDebug(`–°—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ Worker: ${status}`);
            return status || "Unknown";
        
          } catch (err) {
            logDebug("–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ getAircallAvailability —á–µ—Ä–µ–∑ Worker: " + err.message);
            return "Error";
          }
        }

        function passReallocAndLang(empName) {
          const info = employeeData[empName];
          if (!info) return false;
          if (currentReallocFilter !== "all") {
            if (info.canReallocate !== currentReallocFilter) return false;
          }
          if (currentLangFilter !== "all") {
            let lang = info.languages.replace(/\s+/g, "");
            if (currentLangFilter === "two") {
              if (!(lang.includes("üá¶üáø") && lang.includes("üá¨üáß")) || lang.includes("üá∑üá∫")) {
                return false;
              }
            } else if (currentLangFilter === "three") {
              if (!(lang.includes("üá¶üáø") && lang.includes("üá¨üáß") && lang.includes("üá∑üá∫"))) {
                return false;
              }
            }
          }
          return true;
        }

function applyFilters() {
  const container = document.getElementById("platforms-container");
  container.innerHTML = "";

  platforms.forEach((platform) => {
    if (
      !currentPlatformFilter.includes("all") &&
      !currentPlatformFilter.includes(platform.name)
    ) {
      return;
    }

    if (platform.name !== "Aircall") {
      // –°–æ–±–∏—Ä–∞–µ–º active –∏ away
      let activeNames = [];
      for (
        let r = platform.rowActiveNamesStart;
        r <= platform.rowActiveNamesEnd;
        r++
      ) {
        const nm = fetchedData[r]?.[platform.colIndexNames]?.trim();
        if (nm) activeNames.push(nm);
      }
      let awayData = [];
      for (
        let r = platform.rowAwayNamesStart;
        r <= platform.rowAwayNamesEnd;
        r++
      ) {
        const nm = fetchedData[r]?.[platform.colIndexNames]?.trim();
        if (!nm) continue;
        const rsn = fetchedData[r]?.[platform.colIndexData]?.trim() || "";
        awayData.push({ name: nm, reason: rsn });
      }

      // –ü–æ–∏—Å–∫
      if (currentSearchTerm) {
        const term = currentSearchTerm.toLowerCase();
        activeNames = activeNames.filter((n) =>
          n.toLowerCase().includes(term)
        );
        awayData = awayData.filter((a) =>
          a.name.toLowerCase().includes(term)
        );
      }

      // realloc/lang
      activeNames = activeNames.filter((n) => passReallocAndLang(n));
      awayData = awayData.filter((a) => passReallocAndLang(a.name));

      // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
      let showActive = true,
        showAway = true;
      if (currentStatusFilter === "active") showAway = false;
      else if (currentStatusFilter === "away") showActive = false;

      // –ù–∞—á–∞–ª–æ HTML –∫–∞—Ä—Ç–æ—á–∫–∏
      let html = `
        <div class="platform-card">
          <h5>
            <a href="${platform.url}" target="_blank" rel="noopener">${platform.name}</a>
            <span class="info-icon" data-toggle="tooltip" title="${
              platformInfo[platform.name] || ""
            }">
              <img src="https://www.svgrepo.com/show/474873/info.svg" width="16" height="16"/>
            </span>
          </h5>
      `;

      // ‚Äî Active
      if (showActive) {
        if (activeNames.length === 0) {
          html += `<p class="text-center text-warning">‚ö†Ô∏è No active employees</p>`;
        } else {
          html += `<p><small>Active (${activeNames.length})</small></p><ul>`;
          activeNames.forEach((n) => {
            const name = n.trim();
            const isYou = name.toLowerCase() === "mikhail garayev";
            const isNaziya = name.toLowerCase() === "naziya orujova";
            const extraEmoji = isNaziya ? " üéÄ" : "";
            const crown = isYou ? "üëë" : "";

            const rawShift = getEmployeeShiftName(name);
            const shiftName = shiftDisplayNames[rawShift] || rawShift;
            const badgeClass =
              shiftBadgeClasses[shiftName] || "badge-secondary";

            html += `
              <li class="employee-item" data-employee="${name}">
                <span class="badge badge-pill ${badgeClass}">${shiftName}</span>
                <span class="employee-name">${name}${extraEmoji}</span>
                ${crown}
              </li>
            `;
          });
          html += `</ul>`;
        }
      }

// ‚Äî Always render Away section, even if awayData.length === 0
if (showAway) {
  let brbCount = 0;
  html += `<p><small>Away (${awayData.length})</small></p><ul>`;
  awayData.forEach(({ name, reason }) => {
    const txt = reason || "";
    let reasonClass = "";
    // mark overdue breaks
    if (/(Break|BRB)/.test(txt) && /-\d{1,2}:\d{2}(?::\d{2})?/.test(txt)) {
      reasonClass = "break-overdue";
    }
    if (txt.includes("BRB")) brbCount++;

    const rawShift   = getEmployeeShiftName(name);
    const shiftName  = shiftDisplayNames[rawShift] || rawShift;
    const badgeClass = shiftBadgeClasses[shiftName] || "badge-secondary";

    html += `
      <li class="employee-item ${reasonClass}" data-employee="${name}">
        <span class="badge badge-pill ${badgeClass}">${shiftName}</span>
        <span class="employee-name">${name}</span>
        ${txt ? `<span class="text-muted">(${txt})</span>` : ""}
      </li>
    `;
  });
  html += `</ul>`;
  if (brbCount >= 2) {
    html += `
      <p style="text-align:center;color:red;font-size:0.95rem;">
        <span title="2 or more on BRB">&#9888;</span>
        <span style="margin-left:6px;">2 or more on BRB</span>
      </p>
    `;
      const msg = `‚ö†Ô∏è ${brbCount} or more on BRB on ${platform.name}`;
      if (!brbAlertSent[platform.name]) {
      showDesktopNotification('BRB Alert', msg);
      addInPageNotification(msg);
      brbAlertSent[platform.name] = true;
    }
  } else {
    // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ–±—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã—Ö–æ–¥–µ –∑–∞ –ø–æ—Ä–æ–≥ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ —Å–Ω–æ–≤–∞ —É—à–ª–æ
    brbAlertSent[platform.name] = false;
  }
}

      html += `</div>`;
      container.innerHTML += html;
    } else {
      // Aircall –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ –±—ã–ª–æ
      let filteredActive = aircallActive.filter(
        (n) => n.toLowerCase() !== "away"
      );
      let filteredAway = aircallAway.filter(
        ({ name }) => name.toLowerCase() !== "away"
      );

      if (currentSearchTerm) {
        const term = currentSearchTerm.toLowerCase();
        filteredActive = filteredActive.filter((n) =>
          n.toLowerCase().includes(term)
        );
        filteredAway = filteredAway.filter(({ name }) =>
          name.toLowerCase().includes(term)
        );
      }
      filteredActive = filteredActive.filter((n) => passReallocAndLang(n));
      filteredAway = filteredAway.filter((a) => passReallocAndLang(a.name));

      const showActive = currentStatusFilter !== "away";
      const showAway = currentStatusFilter !== "active";

      renderAircallCardWithStatuses(
        filteredActive,
        filteredAway,
        showActive,
        showAway
      );
    }
  });

  // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –∫–ª–∏–∫ –¥–ª—è –º–æ–¥–∞–ª–∫–∏
  container.querySelectorAll(".employee-item").forEach((item) => {
    item.addEventListener("click", () =>
      openEmployeeModal(item.getAttribute("data-employee"))
    );
  });

  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã Aircall
  setTimeout(() => fetchAircallStatuses().catch(console.error), 100);

  checkOverdueBRB();
}


function renderAircallCardWithStatuses(
  activeList,
  awayList,
  showActive = true,
  showAway = true
) {
  const aircallPlatform = platforms.find((p) => p.name === "Aircall");
  let html = `
    <div class="platform-card">
      <h5>
        <a href="${aircallPlatform.url}" target="_blank" rel="noopener">Aircall</a>
        <span class="info-icon" data-toggle="tooltip" title="${platformInfo["Aircall"]||""}">
          <img src="https://www.svgrepo.com/show/474873/info.svg" width="16" height="16"/>
        </span>
      </h5>`;

  // Active
    if (showActive) {
    if (activeList.length === 0) {
      html += `<p class="text-center text-warning">‚ö†Ô∏è No active employees</p>`;
    } else {
      html += `<p><small>Active (${activeList.length})</small></p><ul id="aircall-active-list">`;
      activeList.forEach((name, i) => {
        const rawShift   = getEmployeeShiftName(name);
        const shiftName  = shiftDisplayNames[rawShift] || rawShift;
        const badgeClass = shiftBadgeClasses[shiftName] || "badge-secondary";
        const safeId     = `aircall-active-${i}`;
        html += `
          <li id="${safeId}" class="employee-item d-flex align-items-center" data-employee="${name}">
            <span class="badge badge-pill ${badgeClass}" style="margin-right:6px;">
              ${shiftName}
            </span>
            <span class="employee-name" style="margin-right:6px;">${name}</span>
            &nbsp;‚Äì&nbsp;<span class="aircall-status">Checking...</span>
          </li>
        `;
      });
      html += `</ul>`;
    }
  }

  // Away
  if (showAway) {
    html += `<p><small>Away (${awayList.length})</small></p><ul>`;
    awayList.forEach(({ name, reason }) => {
      // –ë–µ—Ä—ë–º —Å–º–µ–Ω—É –∏ –±–µ–π–¥–∂
      const rawShift   = getEmployeeShiftName(name);
      const shiftName  = shiftDisplayNames[rawShift] || rawShift;
      const badgeClass = shiftBadgeClasses[shiftName] || "badge-secondary";

      // –õ–æ–≥–∏–∫–∞ –ø–æ–∫—Ä–∞—Å–∫–∏ –≤ –∫—Ä–∞—Å–Ω—ã–π, –µ—Å–ª–∏ –µ—Å—Ç—å BRB –∏–ª–∏ Break
      const isOverdue =
      /(?:Break|BRB)/i.test(reason || "") &&
      /-([0-9]{2}:[0-9]{2})/.test(reason || "");
      const liClass   = isOverdue ? "break-overdue" : "";

      const extra = reason ? ` (${reason})` : "";

      html += `
      <li class="employee-item d-flex align-items-center ${liClass}" data-employee="${name}">
        <span class="badge badge-pill ${badgeClass}" style="margin-right:6px;">
          ${shiftName}
        </span>
        <span class="employee-name" style="margin-right:6px;">
          ${name}
        </span>
        <span class="text-muted">${extra}</span>
      </li>`;
  });
  html += `</ul>`;
}

  html += `</div>`;

  // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ DOM –∏ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç—É—Å—ã
  document.getElementById("platforms-container").innerHTML += html;
    setTimeout(() => {
    fetchAircallStatuses().catch(console.error);
  }, 100);
}


  function renderShiftSummary(data) {
  // –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –≥–¥–µ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –≤—Å–µ stats-card
  const generalContainer  = document.getElementById("summary-general");
const platformContainer = document.getElementById("summary-platforms");
generalContainer.innerHTML  = "";
platformContainer.innerHTML = "";

  // –≤–∞—à–∏ –∫–∞—Ä—Ç–æ—á–∫–∏: title ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫, value ‚Äî —Å—Ç—Ä–æ–∫–∞ –∏–∑ —è—á–µ–π–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä "2, Alice, Bob"), away ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  const summaryCards = [
    { title: "On shift now",  value: data[6][27] || "" },
    { title: "Should be",     value: data[6][29] || "" },
    { title: "CS",            value: data[6][31] || "", away: data[8][31] || "" },
    { title: "CS/Post Order", value: data[6][33] || "", away: data[8][33] || "" },
    { title: "PSR",           value: data[6][35] || "", away: data[8][35] || "" },
    { title: "SiMo",          value: data[6][41] || "", away: data[8][41] || "" },
    { title: "Aircall",       value: data[6][39] || "", away: data[8][39] || "" },
    { title: "Venue",         value: data[6][37] || "", away: data[8][37] || "" },
    { title: "Trainee",       value: data[11][41] || "", away: data[13][41] || "" },
    { title: "ST",            value: data[6][43] || "", away: data[8][43] || "" },
    // Special: Not here –∏ WNATS —Ç–æ–∂–µ –¥–µ–ª–∞—é—Ç –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ 29 –∏ 27, –ø–ª—é—Å –¥–µ—Ç–∞–ª–∏ –∏–∑ –∫–æ–ª–æ–Ω–∫–∏ 10
    { 
      title: "Not here", 
      value: (data[8][29] || "") + (data[10][29] ? "," + data[10][29] : ""), 
      customClass: "small-font-card" 
    },
    { 
      title: "WNATS", 
      value: (data[8][27] || "") + (data[10][27] ? "," + data[10][27] : ""), 
      customClass: "small-font-card" 
    }
  ];

  summaryCards.forEach(card => {
    // –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–∂–µ count ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
    if (!card.value) return;

    // —Å–æ–∑–¥–∞—ë–º div.stats-card
    const div = document.createElement("div");
    div.className = `stats-card ${card.customClass || ""}`;

    // —Ä–∞–∑–±–∏—Ä–∞–µ–º –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç—É–ª—Ç–∏–ø–æ–≤
    if (card.title === "Not here" || card.title === "WNATS") {
      // value = "count, detail1, detail2, ‚Ä¶"
      const parts = card.value.split(",").map(s => s.trim()).filter(s => s !== "");
      const count = parts.shift();        // –ø–µ—Ä–≤–æ–µ ‚Äî —á–∏—Å–ª–æ
      const details = parts;              // –æ—Å—Ç–∞—Ç–æ–∫ ‚Äî –º–∞—Å—Å–∏–≤ —Ç—É–ª—Ç–∏–ø–æ–≤
      // –µ—Å–ª–∏ Not here –∏ count ‚â† 0, –¥–æ–±–∞–≤–ª—è–µ–º –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω
      if (card.title === "Not here" && count !== "0") {
        div.classList.add("red-card");
      }
      // —Ñ–æ—Ä–º–∏—Ä—É–µ–º HTML
      div.innerHTML = `
        <div class="stats-title">${card.title}</div>
        <div class="stats-value d-inline-flex align-items-center gap-1">
          ${count}
          <img
            src="https://www.svgrepo.com/show/474873/info.svg"
            data-toggle="tooltip"
            data-html="true"
            title="${details.join("<br/>")}"
            class="info-icon"
            style="width:16px; height:16px; cursor:pointer;"
          />
        </div>
      `;
    } else {
      // –æ–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞: title, value, away
      let html = `
        <div class="stats-title">${card.title}</div>
        <div class="stats-value">${card.value}</div>
      `;
      html += `
      <div class="stats-value" style="font-size:0.9rem; color:#666;">
      Away: ${card.away || 0}
      </div>`;

      div.innerHTML = html;
    }

    // —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π ¬´–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö¬ª –∫–∞—Ä—Ç–æ—á–µ–∫
const platformTitles = [
  "CS",
  "CS/Post Order",
  "PSR",
  "SiMo",
  "Aircall",
  "Venue",
  "Trainee",
  "ST"
];

// –µ—Å–ª–∏ —ç—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ‚Äî –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –≥—Ä–∏–¥,
// –∏–Ω–∞—á–µ ‚Äî –≤ –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
if (platformTitles.includes(card.title)) {
  platformContainer.appendChild(div);
} else {
  generalContainer.appendChild(div);
}
  });

  // –≤—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–≥–æ–¥—É –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ä—Ç–æ—á–∫—É
  // –Ω–æ–≤—ã–π –∫–æ–¥ ‚Äî –≤ –∫–æ–Ω—Ü–µ renderShiftSummary
    // –≤—Å—Ç–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–≥–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤
    const weatherCities = [
    { city: "Baku,AZ",        title: "Baku Weather",       tempId: "temp-baku",  windId: "wind-baku" },
    { city: "Ganja,AZ",       title: "Ganja Weather",      tempId: "temp-ganja", windId: "wind-ganja" },
    { city: "Lankaran,AZ",    title: "Lankaran Weather",   tempId: "temp-lank",  windId: "wind-lank" },
    { city: "Nakhchivan,AZ",  title: "Nakhchivan Weather", tempId: "temp-nakh",  windId: "wind-nakh" },
    { city: "Mingachevir,AZ", title: "Mingachevir Weather",tempId: "temp-ming",  windId: "wind-ming" }
  ];

  weatherCities.forEach(({ city, title, tempId, windId }) => {
    const card = document.createElement("div");
    card.className = "stats-card";
    card.innerHTML = `
      <div class="stats-title">${title}</div>
      <div class="stats-value" id="${tempId}">--</div>
      <div class="stats-title" style="margin-top:.5rem;">Wind Speed</div>
      <div class="stats-value small" id="${windId}">--</div>
    `;
    generalContainer.appendChild(card);
    // –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –∏ —ç—Ç–∏—Ö id
    fetchWeatherFor(city, tempId, windId);
  });

}

function renderResponsiblePeople(data) {
  if (!Array.isArray(data) || data.length === 0) return;

  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∫–∞—Ä—Ç–æ—á–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
  const existing = document.getElementById("responsible-card");
  if (existing) existing.remove();

  // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏ "Shift Lead‚Ä¶" –∏ "In charge‚Ä¶"
  const responsibleRows = data.filter(([name, role]) =>
  /shift\s+lead/i.test(role) || /in\s+charge/i.test(role)
);
  if (responsibleRows.length === 0) return;

  // –ù–∞—á–∞–ª–æ HTML
  let html = `
    <div class="shift-summary-card" id="responsible-card">
      <div class="shift-summary-title">üë• Responsible People</div>
      <table class="shift-summary-grid" style="max-width:500px; margin:0 auto;">
        <thead><tr><th>Name</th><th>Position</th></tr></thead>
        <tbody>`;

  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç—Ä–æ–∫–∏
  responsibleRows.forEach(([rawName, rawRole]) => {
    const name = rawName.trim();
    const role = rawRole.trim();
    const lowerName = name.toLowerCase();

    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç–º–æ–¥–∑–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const isNaziya = lowerName === 'naziya orujova';
    const isRafig  = lowerName === 'rafig huseynov';
    let extraEmoji = '';
    if (isNaziya) extraEmoji = ' üéÄ';
    else if (isRafig)  extraEmoji = ' (Àµ Õ°¬∞ Õú ñ Õ°¬∞Àµ)';

    const nameClass = isNaziya ? 'pink-name' : '';

    html += `
      <tr>
        <td>
          <span class="${nameClass}" style="font-weight:bold;">
            ${name}${extraEmoji}
          </span>
        </td>
        <td>
          <span style="
            background: #e7f1ff;
            color: #0056b3;
            padding: 2px 6px;
            border-radius: 6px;
            font-size: 0.85rem;
          ">
            ${role}
          </span>
        </td>
      </tr>`;
  });

  // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –≤ DOM
  html += `
        </tbody>
      </table>
    </div>`;

  document
    .getElementById('shift-overs-section')
    .insertAdjacentHTML('beforebegin', html);
}


function renderShiftOvers() {
  const container = document.getElementById("shift-overs-app");
  container.innerHTML = ""; 
  if (!window.shiftsQuinyxData) {
    container.textContent = "No data";
    return;
  }

  const now = new Date();
  const oneHourLater = new Date(now.getTime() + 60*60*1000);

  // —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
  const upcoming = window.shiftsQuinyxData.filter(({name, shift}) => {
    const parts = shift.split("-");
    if (parts.length < 2) return false;
    const [ hh, mm ] = parts[1].split(":").map(Number);
    const endDate = new Date(now);
    endDate.setHours(hh, mm, 0, 0);
    return endDate > now && endDate <= oneHourLater;
  });

  if (upcoming.length === 0) {
    container.innerHTML = "<p style='text-align:center;color:#666;'>No shift-overs in the next hour</p>";
    return;
  }

  // —Å–ø–∏—Å–æ–∫
  const ul = document.createElement("ul");
  upcoming.forEach(({name, shift}) => {
    const li = document.createElement("li");
    li.innerHTML = `<strong>${name}</strong> ‚Äî ${shift}`;
    ul.appendChild(li);
  });
  container.appendChild(ul);
}

                // 1) Shift-Overs –∏–∑ –ª–∏—Å—Ç–∞ shiftsquinyx!A:C
        async function fetchShiftOversData() {
  const raw = await fetchSheetData("shiftsquinyx!A:C"); // —Ç–µ–ø–µ—Ä—å A-C, –∞ –Ω–µ B-C
  if (!raw) {
    document.getElementById("shift-overs-app").textContent = "Error";
    return;
  }

  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ –≤ –æ–±—ä–µ–∫—Ç—ã —Å –ø–æ–ª—è–º–∏ Name, ShiftName –∏ Shift
  const arr = raw.slice(1).map(row => ({
    ShiftName: row[0]?.trim(),   // A = –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–º–µ–Ω—ã
    Name: row[1]?.trim(),        // B = –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    Shift: row[2]?.trim(),       // C = –≤—Ä–µ–º—è —Å–º–µ–Ω—ã
  }));

  const now = new Date();
  const next = new Date(now.getTime() + 60 * 60 * 1000);

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –æ—Ç–±–∏—Ä–∞–µ–º —Ç–µ—Ö, —É –∫–æ–≥–æ shift –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞
  const upcoming = arr.filter(r => {
    if (!r.Shift) return false;
    const parts = r.Shift.split("-");
    if (parts.length !== 2) return false;

    const [h, m] = parts[1].split(":").map(Number);
    if (isNaN(h)) return false;

    const end = new Date(now);
    end.setHours(h, m, 0, 0);
    return end > now && end <= next;
  });

  const c = document.getElementById("shift-overs-app");

  if (!upcoming.length) {
    c.innerHTML = "<p>No shift-overs in the next hour</p>";
    return;
  }

  // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ shiftName + –≤—Ä–µ–º—è
  const counts = {};
  upcoming.forEach(r => {
    const key = `${r.ShiftName}‚Äì${r.Shift}`;
    counts[key] = (counts[key] || 0) + 1;
  });

  c.innerHTML = "<ul>" + upcoming.map(r => {
    const [start, end] = r.Shift.split("-").map(s => s.trim());
    const key = `${r.ShiftName}‚Äì${r.Shift}`;
    const conflictClass = counts[key] > 1 ? "break-conflict" : "";

    return `
      <li class="${conflictClass}">
        <strong>${r.Name}</strong><br/>
        Ends at ${end}<br/>
        Shift: ${start} | ${r.ShiftName}
      </li>`;
  }).join("") + "</ul>";
}



        
async function fetchBreaksData() {
  const raw = await fetchSheetData(BREAKS_RANGE);
  if (!raw) {
    document.getElementById("breaks-app").textContent = "Error";
    return;
  }

  const arr = arrayToObjects(raw);
  const now = new Date();
  const nextHour = new Date(now.getTime() + 3600 * 1000);
  window.allBreaksData = arr;

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–∂–∏–º—É
  let list;
  if (currentBreakFilter === "upcoming") {
    list = arr.filter(r => {
      const [h, m] = (r["Break Time"] || "").split(":").map(Number);
      if (isNaN(h)) return false;
      const dt = new Date(now);
      dt.setHours(h, m, 0, 0);
      return dt > now && dt <= nextHour;
    });
  } else {
    list = arr.slice().sort((a, b) => {
      const pa = parseTimeToMinutes(a["Break Time"]),
            pb = parseTimeToMinutes(b["Break Time"]);
      return pa - pb;
    });
  }

  const c = document.getElementById("breaks-app");

  // –ü–æ–¥—Å—á—ë—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
  const counts = {};
  list.forEach(r => {
    const key = `${r["Working Space"]}‚Äì${r["Break Time"]}`;
    counts[key] = (counts[key] || 0) + 1;
  });

  if (!list.length) {
    c.innerHTML = "<p>No breaks</p>";
  } else {
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML —Å–ø–∏—Å–∫–∞
    c.innerHTML = "<ul>" + list.map(r => {
      const key = `${r["Working Space"]}‚Äì${r["Break Time"]}`;
      const conflictClass = counts[key] > 1 ? "break-conflict" : "";
      return `
        <li class="${conflictClass}">
          <strong>${r.Name}</strong><br/>
          Break at
            <span class="break-time"
                  data-name="${r.Name}"
                  data-time="${r["Break Time"]}"
            >${r["Break Time"]}</span>
          <button class="edit-btn"
                  title="Edit time"
                  style="border:none;background:none;cursor:pointer;">
            <img src="https://www.svgrepo.com/show/502640/edit-1.svg"
                 alt="edit" width="16" height="16">
          </button><br/>
          Shift: ${r["Shift Start Time"]} | ${r["Working Space"]}
        </li>
      `;
    }).join("") + "</ul>";

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
    document.querySelectorAll(".edit-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const name = btn.previousElementSibling.dataset.name;
        const timeSpan = btn.previousElementSibling;
        const oldTime = timeSpan.dataset.time;
        const newTime = prompt(`Enter new break time for ${name}:`, oldTime);
        if (!newTime || newTime === oldTime) return;
        fetch("https://breaks-proxy.mikhail-garayev.workers.dev/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name,
            newBreakTime: newTime,
            secret: "superWoltKey42"
          })
        })
        .then(res => res.text())
        .then(response => {
          if (response === "Success") {
            timeSpan.textContent = newTime;
            timeSpan.dataset.time = newTime;
            alert("Break time updated successfully!");
          } else {
            alert("Server response:\n" + response);
          }
        })
        .catch(err => {
          alert("Request failed:\n" + err.message);
        });
      });
    });
  }

  // ===== –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã –∏ —É–≤–µ–¥–æ–º–ª—è–µ–º =====
  (function checkOverdueBreaks() {
  const ALLOWED_BREAK_MINUTES = 60;
  const now = new Date();

  // 1) –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏, –ø–æ–º–µ—á–µ–Ω–Ω—ã–µ active –ø–æ –ª–∏—Å—Ç—É
  const activeSet = new Set();
  platforms.forEach(p => {
    for (let r = p.rowActiveNamesStart; r <= p.rowActiveNamesEnd; r++) {
      const nm = fetchedData[r]?.[p.colIndexNames]?.trim();
      if (nm) activeSet.add(nm.toLowerCase());
    }
  });

  // 2) –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –ø–µ—Ä–µ—Ä—ã–≤–∞–º
  (window.allBreaksData || []).forEach(r => {
    const name = r.Name?.trim();
    if (!name) return;
    const key = name.toLowerCase();

    // –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ —Å–Ω–æ–≤–∞ active ‚Äî –æ—á–∏—â–∞–µ–º —Ñ–ª–∞–≥ –∏ –Ω–µ —É–≤–µ–¥–æ–º–ª—è–µ–º
    if (activeSet.has(key)) {
      if (overdueBreakNotified[key]) {
        delete overdueBreakNotified[key];
        localStorage.setItem(BREAK_NOTIF_KEY, JSON.stringify(overdueBreakNotified));
      }
      return;
    }

    // **–ù–û–í–´–ô –ë–õ–û–ö**: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –ª–∏ —É –Ω–µ–≥–æ —Å–º–µ–Ω–∞
    // –∏—â–µ–º –≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–º–µ–Ω–∞–º
    const shiftRec = (window.shiftsQuinyxData || [])
      .find(x => x.name.trim().toLowerCase() === key);
    if (shiftRec) {
      const [, endStr] = shiftRec.shift.split('-');
      const [eh, em] = endStr.split(':').map(Number);
      const endDate = new Date(now);
      endDate.setHours(eh, em, 0, 0);
      // –µ—Å–ª–∏ —Å–µ–π—á–∞—Å —É–∂–µ –ø–æ—Å–ª–µ –∫–æ–Ω—Ü–∞ —Å–º–µ–Ω—ã ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
      if (now > endDate) {
        // –∏ –æ—á–∏—â–∞–µ–º —Ñ–ª–∞–≥ –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –∫–æ–≥–¥–∞-—Ç–æ –±—ã–ª–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        if (overdueBreakNotified[key]) {
          delete overdueBreakNotified[key];
          localStorage.setItem(BREAK_NOTIF_KEY, JSON.stringify(overdueBreakNotified));
        }
        return;
      }
    }

    // 3) –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å break-–∞
    const [h, m, s = 0] = (r["Break Time"] || "").split(":").map(Number);
    const breakDate = new Date(now);
    breakDate.setHours(h, m, s, 0);
    const durationMins = (now - breakDate) / 60000;

    if (durationMins > ALLOWED_BREAK_MINUTES) {
      if (!overdueBreakNotified[key]) {
        const lateMin = Math.floor(durationMins);
        const msg = `‚ùó ${name} is late from break for ${lateMin} min.`;
        showDesktopNotification("Break overdue", msg);
        addInPageNotification(msg);
        overdueBreakNotified[key] = true;
        localStorage.setItem(BREAK_NOTIF_KEY, JSON.stringify(overdueBreakNotified));
      }
    }
  });
})();
}

        function checkOverdueBRB() {
  // –Ω–∞–π–¥—ë–º –≤—Å–µ li, –ø–æ–º–µ—á–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–æ–º break-overdue –∏ —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ "BRB"
  const overdueBRB = Array.from(
    document.querySelectorAll('.employee-item.break-overdue')
  ).filter(li => /\bBRB\b/.test(li.textContent));

  // –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ ‚Äî —à–ª—ë–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  overdueBRB.forEach(li => {
    const name = li.dataset.employee;
    if (!brbOverdueNotified[name]) {
      const reason = li.querySelector('.text-muted')?.textContent || '';
      const msg = `‚è∞ ${name} is late from BRB ${reason}`;
      showDesktopNotification('BRB Overdue', msg);
      addInPageNotification(msg);
      brbOverdueNotified[name] = true;
    }
  });

  // —Å–±—Ä–æ—Å–∏–º —Ñ–ª–∞–≥, –µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ —É–∂–µ –Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω
  Object.keys(brbOverdueNotified).forEach(name => {
    if (!overdueBRB.some(li => li.dataset.employee === name)) {
      delete brbOverdueNotified[name];
    }
  });
}
        
        // –∫–ª–∞–¥—ë–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é window.shiftsQuinyxData
        async function fetchShiftsQuinyxData() {
          const raw = await fetchSheetData("shiftsquinyx!A2:C");
          if (!raw || raw.length < 2) {
            window.shiftsQuinyxData = [];
            return;
          }
          // raw[0] ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏, raw[1..] ‚Äî —Å—Ç—Ä–æ–∫–∏ [name, "HH:mm-HH:mm"]
          window.shiftsQuinyxData = raw
          .filter(r => r[0] && r[1] && r[2])
          .map(r => ({
            platform: r[0].trim(), // A: SHIFT TYPE
            name: r[1].trim(),     // B: Name
            shift: r[2].trim()     // C: Shift time
          }));
        }


        function parseTimeToMinutes(timeStr) {
          timeStr = timeStr.trim();
          let parts = timeStr.split(":");
          if (parts.length < 2) return 0;
          let hours = parseInt(parts[0], 10);
          let minutes = parseInt(parts[1], 10);
          return hours * 60 + minutes;
        }

        function arrayToObjects(arr) {
          if (!arr.length) return [];
          const header = arr[0];
          return arr.slice(1).map((row) => {
            const obj = {};
            header.forEach((key, i) => {
              obj[key] = row[i] || "";
            });
            return obj;
          });
        }

        // ‚Äî‚Äî‚Äî –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ Aircall ‚Äî‚Äî‚Äî
        // ------------------
// –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –≤–º–µ—Å—Ç–æ Checking...
// ------------------
async function fetchAircallStatuses() {
  const spans = Array.from(document.querySelectorAll(".aircall-status"));
  if (!spans.length) return;

  // –ü–æ–º–µ—á–∞–µ–º –≤—Å–µ —Å–ø–∞–Ω—ã –∫–∞–∫ ¬´Loading‚Ä¶¬ª
  spans.forEach(span => {
    span.textContent = "Loading‚Ä¶";
  });

  // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ email
  const emails = [...new Set(spans.map(span => {
    const name = span.closest("li[data-employee]")?.dataset.employee || "";
    return generateWoltEmail(name);
  }))];

  let results = [];
  try {
    const res = await fetch("https://aircall-proxy.mikhail-garayev.workers.dev/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        secret: "superWoltKey42",
        emails: emails
      })
    });
    const json = await res.json();
    results = Array.isArray(json.results) ? json.results : [];
  } catch (e) {
    console.error("Aircall batch error:", e);
  }

  // –°–æ—Å—Ç–∞–≤–ª—è–µ–º –º–∞–ø—É email ‚Üí —Å—Ç–∞—Ç—É—Å
  const statusMap = results.reduce((acc, { email, status, error }) => {
    acc[email] = status ?? error ?? "Unknown";
    return acc;
  }, {});

  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π span
  spans.forEach(span => {
    const li    = span.closest("li[data-employee]");
    const email = generateWoltEmail(li?.dataset.employee || "");
    const status = statusMap[email] || "Error";

    span.textContent = status;
    const safeClass = "status-" + status.toLowerCase().replace(/\s+/g, "-");
    span.className = `aircall-status ${safeClass}`;
  });
}


        let autoRefreshEnabled = true;
        let refreshInterval = 15;
        let refreshTimer = null;
        let countdownTimer = null;
        let countdownValue = refreshInterval;

        function resetAutoRefresh() {
  clearTimeout(refreshTimer);
  clearInterval(countdownTimer);
  countdownValue = refreshInterval;
  updateCountdownDisplay();

  // —á–µ—Ä–µ–∑ –ª—è–º–±–¥—É, —á—Ç–æ–±—ã —É—Å–ø–µ—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å –ø–µ—Ä–µ–¥ fetchData()
  refreshTimer = setTimeout(() => {
    const ico = document.getElementById("refresh-icon");
    ico.classList.add("rotating");  // —Å—Ç–∞—Ä—Ç –∞–Ω–∏–º–∞—Ü–∏–∏
    fetchData();
  }, refreshInterval * 1000);

  countdownTimer = setInterval(() => {
    countdownValue--;
    updateCountdownDisplay();
    if (countdownValue <= 0) clearInterval(countdownTimer);
  }, 1000);
}

        function updateCountdownDisplay() {
          const countdownElem = document.getElementById("countdown");
          if (countdownElem) {
            countdownElem.textContent = countdownValue;
          }
        }
        function toggleAutoRefresh() {
          autoRefreshEnabled = !autoRefreshEnabled;
          const btn = document.getElementById("toggle-autorefresh");
          if (autoRefreshEnabled) {
            btn.textContent = "Disable Auto Refresh";
            resetAutoRefresh();
          } else {
            btn.textContent = "Enable Auto Refresh";
            clearTimeout(refreshTimer);
            clearInterval(countdownTimer);
          }
        }
        // –ö–Ω–æ–ø–∫–∞ Refresh Now –∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞—é—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é
        function refreshNow() {
  const ico = document.getElementById('refresh-icon');
  // –≤–µ—à–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
  ico.classList.add('rotating');

  // –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
  fetchData().finally(() => {
    // –∫–æ–≥–¥–∞ –≤—Å—ë –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–æ ‚Äî –≤—ã–∫–ª—é—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    ico.classList.remove('rotating');
  });
}

        function showDesktopNotification(title, body) {
  if (doNotDisturb) return;       // üõë –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
  if (Notification.permission === "granted") {
    new Notification(title, { body, icon: "favicon.png" });
  }
}

function addInPageNotification(message) {
  if (doNotDisturb) return;       // üõë –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
  notificationQueue.push(message);
  const $cnt = document.getElementById("notification-count");
  $cnt.textContent = notificationQueue.length;
  $cnt.style.display = notificationQueue.length > 0 ? "block" : "none";
}

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ü–∞–Ω–µ–ª—å in-page —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// –∑–∞–≥—Ä—É–∑–∫–∞/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
function loadNotifications() {
  return JSON.parse(localStorage.getItem('notifications') || '[]');
}
function saveNotifications(arr) {
  localStorage.setItem('notifications', JSON.stringify(arr));
}

// –ø—É—à –≤ –æ—á–µ—Ä–µ–¥—å + –±–µ–π–¥–∂
function pushNotification(text) {
  const arr = loadNotifications();
  arr.unshift({ text, timestamp: Date.now(), read: false });
  saveNotifications(arr);
  renderBadge(arr);
}

// —Ä–µ–Ω–¥–µ—Ä –±–µ–π–¥–∂–∞ –Ω–∞ –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–µ
function renderBadge(arr) {
  const unread = arr.filter(n => !n.read).length;
  const $cnt = document.getElementById('notification-count');
  if (unread > 0) {
    $cnt.textContent = unread;
    $cnt.style.display = 'block';
  } else {
    $cnt.style.display = 'none';
  }
}

// —Ä–µ–Ω–¥–µ—Ä –ø–∞–Ω–µ–ª–∏
function renderPanel() {
  const arr = loadNotifications();
  const panel = document.getElementById('notifications-panel');
  if (!arr.length) {
    panel.innerHTML = '<p class="p-3 text-center text-muted">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>';
    return;
  }
  panel.innerHTML = '<ul class="list-group">' +
    arr.map((n, i) => {
      const cls = n.read ? 'read' : 'unread';
      const time = new Date(n.timestamp).toLocaleTimeString();
      return `<li class="list-group-item ${cls}">${n.text}
                <br><small class="text-muted">${time}</small>
              </li>`;
    }).join('') +
    '</ul>';
}

// –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–Ω–µ–ª–∏ ‚Äî –ø–æ–º–µ—á–∞–µ–º ¬´–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏¬ª
function markAllRead() {
  const arr = loadNotifications().map(n => ({ ...n, read: true }));
  saveNotifications(arr);
  renderBadge(arr);
  renderPanel();
}

// –ø–µ—Ä–µ—Ö–≤–∞—Ç in-page —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function addInPageNotification(message) {
  if (doNotDisturb) return;
  pushNotification(message);
}

// –∫–ª–∏–∫ –ø–æ –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫—É
document.getElementById('notification-bell').addEventListener('click', () => {
  const panel = document.getElementById('notifications-panel');
  panel.classList.toggle('show');
  if (panel.classList.contains('show')) {
    renderPanel();
    markAllRead();
  }
});

// –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–π–¥–∂–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
renderBadge(loadNotifications());



        async function fetchData() {
          const data = await fetchSheetData(RANGE);
          fetchedData = data;
          const shiftData = await fetchSheetData(SHIFT_RANGE);
          window.allShiftData = shiftData;

          await fetchEmployeeList();
          await fetchShiftsQuinyxData();     
          await fetchShiftOversData();

          // –ü–µ—Ä–µ–≤–æ–¥–∏–º –æ–±—ä–µ–∫—Ç employeeData ‚Üí –º–∞—Å—Å–∏–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
          window.empList = Object.entries(employeeData).map(([name, info]) => ({
            name,
            canReallocate: info.canReallocate,
            prime: info.prime,
            pref: info.pref,
            languages: info.languages,
            // capacity —É –≤–∞—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ info.capacity
            maxChats: parseInt(info.capacity, 10) || 0,
            // –ò –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ fetchEmployeeList()
            // –∏ –∑–¥–µ—Å—å –≤–æ–∑—å–º–∏—Ç–µ –µ—ë –∫–∞–∫ info.startDate
            startDate: info.startDate 
          }));

          // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Aircall
          const aircallConfig = platforms.find((p) => p.name === "Aircall");
          aircallActive = [];
          aircallAway = [];
          for (
            let r = aircallConfig.rowActiveNamesStart;
            r <= aircallConfig.rowActiveNamesEnd;
            r++
          ) {
            const name = data[r]?.[aircallConfig.colIndexNames]?.trim();
            if (name) aircallActive.push(name);
          }
          for (
            let r = aircallConfig.rowAwayNamesStart;
            r <= aircallConfig.rowAwayNamesEnd;
            r++
          ) {
            const name = data[r]?.[aircallConfig.colIndexNames]?.trim();
            const reason = data[r]?.[aircallConfig.colIndexData]?.trim() || "";
            if (name) aircallAway.push({ name, reason });
          }

          renderShiftSummary(data);
          const responsiblesData = await fetchSheetData(RESPONSIBLES_RANGE);
          renderResponsiblePeople(responsiblesData);
          await fetchBreaksData();
          await fetchShiftsQuinyxData();
          await fetchStatusChanges();
          fetchAircallStatuses();
          applyFilters();
          checkEmptyPlatforms(data);
          
          // –ø–æ–¥–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É
          document.getElementById('find-candidate')
          .addEventListener('click', findCandidate);
          
          document.getElementById("refresh-icon").classList.remove('rotating');
          if (autoRefreshEnabled) resetAutoRefresh();
        }

        function getPrimaryPlatform(empName) {
          if (!window.shiftsQuinyxData) return null;
        
          const found = window.shiftsQuinyxData.find(row =>
            row.name.toLowerCase() === empName.toLowerCase()
          );
        
          return found?.platform || null;
        }

        function saveNotifiedEmpty() {
          localStorage.setItem(STORAGE_KEY, JSON.stringify([...notifiedEmpty]));
        }
        // –¥–ª—è –∫–∞–∂–¥–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å–º–æ—Ç—Ä–∏–º, –Ω–µ —Å—Ç–∞–ª–æ –ª–∏ 0 –∞–∫—Ç–∏–≤–Ω—ã—Ö
function checkEmptyPlatforms(data) {
  // summaryCards –≤ renderShiftSummary ‚Äî –≤ data[6] —Å—Ç—Ä–æ—á–∫–∞ ¬´On shift now¬ª –≤ 6-–º —Ä—è–¥—É, –Ω–æ –Ω–∞–º –ø—Ä–æ—â–µ —Ä—É–∫–∞–º–∏ –ø–µ—Ä–µ–±—Ä–∞—Ç—å
  const platformCols = {
    "CS": 31,
    "CS/Post Order": 33,
    "PSR": 35,
    "SiMo": 41,
    "Aircall": 39,
    "Venue": 37,
    "Trainee": 41,   // —Ç—É—Ç –≤ –≤–∞—à–µ–º summaryCards –æ–Ω–∏ –±—Ä–∞–ª–∏ data[11][41]
    "ST": 43
  };
  Object.entries(platformCols).forEach(([name, colIdx]) => {
    const count = parseInt(data[6][colIdx] || "0", 10);

    // –µ—Å–ª–∏ 0 –∏ –µ—â—ë –Ω–µ —É–≤–µ–¥–æ–º–ª—è–ª–∏
    if (count === 0 && !notifiedEmpty.has(name)) {
      notifiedEmpty.add(name);
      saveNotifiedEmpty();              // —Å–æ—Ö—Ä–∞–Ω–∏–º —Å—Ä–∞–∑—É
      const msg = `‚ö†Ô∏è No active employees on ${name}`;
      showDesktopNotification("Empty platform", msg);
      addInPageNotification(msg);
    }

    // –µ—Å–ª–∏ —Å–Ω–æ–≤–∞ –ø–æ—è–≤–∏–ª–æ—Å—å ‚Äî —Å–±—Ä–æ—Å–∏–º, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —É—Ö–æ–¥–µ –≤ 0 –º–æ–∂–Ω–æ –±—ã–ª–æ —É–≤–µ–¥–æ–º–∏—Ç—å —Å–Ω–æ–≤–∞
    if (count > 0 && notifiedEmpty.has(name)) {
      notifiedEmpty.delete(name);
      saveNotifiedEmpty();              // –∏ —ç—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–º
    }
  });
}

// ‚Ä¶–≤–Ω—É—Ç—Ä–∏ fetchData(), —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ renderShiftSummary(data):

        
        function generateWoltEmail(name) {
          if (!name) return "";
          const parts = name.split(" ");
          return parts.length < 2
            ? parts[0].toLowerCase() + "@wolt.com"
            : parts[0].toLowerCase() +
                "." +
                parts[1].toLowerCase() +
                "@wolt.com";
        }

        function getUpcomingShiftOvers() {
        if (!window.shiftsQuinyxData) return [];
        const now = new Date();
        const oneHourLater = new Date(now.getTime() + 60*60*1000);

        return window.shiftsQuinyxData
          .filter(({name, shift}) => {
            // –∏–∑ "06:00-15:00" –±–µ—Ä—ë–º –≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å ‚Äì –≤—Ä–µ–º—è –∫–æ–Ω—Ü–∞
            const endStr = shift.split("-")[1];
            if (!endStr) return false;
            // —Å–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–∞—Ç—É-–æ–±—ä–µ–∫—Ç: —Å–µ–≥–æ–¥–Ω—è + endStr
            const [hh, mm] = endStr.split(":").map(Number);
            const endDate = new Date(now);
            endDate.setHours(hh, mm, 0, 0);

            return endDate > now && endDate <= oneHourLater;
          })
          .map(o => o.name);
      }

      function setLogoutIcon(isDark) {
        const logoutBtn = document.getElementById("logout-btn");
        if (!logoutBtn) return;
        // –µ—Å–ª–∏ –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ —á—Ç–æ –∏ HTML:
        logoutBtn.src = isDark
          ? "log-out-white.svg"   // –±–µ–ª–∞—è –∏–∫–æ–Ω–∫–∞
          : "log-out.svg";        // —Ü–≤–µ—Ç–Ω–∞—è, –∏—Å—Ö–æ–¥–Ω–∞—è
      }

      function loadThemePreference() {
  const isDark = localStorage.getItem("darkThemeEnabled") === "true";
  document.body.classList.toggle("dark-theme", isDark);

  const bellIcon = document.querySelector("#notification-bell img");
  bellIcon.src = isDark
    ? "https://www.svgrepo.com/show/526479/bell-off.svg"
    : "https://www.svgrepo.com/show/527618/bell-off.svg";

  const themeCheckbox = document.getElementById("theme-checkbox");
  if (themeCheckbox) themeCheckbox.checked = isDark;
  setLogoutIcon(isDark);
}



        
      function toggleTheme(e) {
  const isDark = e.target.checked;
  document.body.classList.toggle("dark-theme", isDark);

  // –ø–æ–¥–º–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫—É:
  const bellIcon = document.querySelector("#notification-bell img");
  bellIcon.src = isDark
    ? "https://www.svgrepo.com/show/526479/bell-off.svg"
    : "https://www.svgrepo.com/show/527618/bell-off.svg";

  localStorage.setItem("darkThemeEnabled", isDark);
  setLogoutIcon(isDark);
}


function findCandidate() {
  const target = document.getElementById('target-platform').value;
  if (!target) {
    return alert('Select the platform first');
  }
  const now = new Date();

  // –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –ø—Ä–∏–≤–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É –∫ –µ–¥–∏–Ω–æ–º—É –∫–ª—é—á—É
  const canonical = str =>
    str.toLowerCase().replace(/[^a-z0-9]/g, '');

  const targetKey = canonical(target);

  // 1) —Ç–æ–ª—å–∫–æ —Ç–µ, –∫—Ç–æ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞—Ç—å—Å—è
  const pool = window.empList.filter(e => e.canReallocate === 'Yes');
  if (!pool.length) {
    $('#candidateModalBody').html(
      '<div class="alert alert-warning">No employees to reallocate</div>'
    );
    return $('#candidateModal').modal('show');
  }

  const badStatuses = ['will not attend the shift', 'not attended the shift'];

  const candidates = pool.map(e => {
    // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ ¬´–Ω–µ –±—É–¥–µ—Ç/–Ω–µ –ø—Ä–∏—à—ë–ª¬ª
    const rowIdx = fetchedData.findIndex(row =>
      row.some(cell =>
        typeof cell === 'string' &&
        cell.trim().toLowerCase() === e.name.toLowerCase()
      )
    );
    if (rowIdx < 0) return null;
    const shiftIdx = rowIdx - 4;
    const shifts   = window.allShiftData || [];
    if (shiftIdx >= 1 && shiftIdx < shifts.length) {
      if (shifts[shiftIdx].some(cell =>
        typeof cell === 'string' &&
        badStatuses.some(bs => cell.trim().toLowerCase().includes(bs))
      )) {
        return null;
      }
    }

    // 2. –ù–∞ —Å–º–µ–Ω–µ?
    const rec = window.shiftsQuinyxData.find(r =>
      r.name.toLowerCase() === e.name.toLowerCase()
    ) || {};
    const parts = (rec.shift || '').split('-');
    if (parts.length < 2) return null;
    const [startStr, endStr] = parts;
    const [sh, sm] = startStr.split(':').map(Number);
    const [eh, em] = endStr.split(':').map(Number);
    const sd = new Date(now); sd.setHours(sh, sm, 0, 0);
    const ed = new Date(now); ed.setHours(eh, em, 0, 0);
    if (now < sd || now > ed) return null;

    // 3. –ù–µ –Ω–∞ –±—Ä–µ–π–∫–µ?
    const br = (window.allBreaksData || []).find(b =>
      b.Name.trim().toLowerCase() === e.name.trim().toLowerCase()
    );
    if (br) {
      const [bh, bm] = (br['Break Time'] || '').split(':').map(Number);
      const bd = new Date(now); bd.setHours(bh, bm, 0, 0);
      if (now >= bd && now < new Date(bd.getTime() + 15*60*1000)) {
        return null;
      }
    }

    // 4. –†–∞—Å—á—ë—Ç –æ–ø—ã—Ç–∞ –∏ —Å–∫–æ—Ä–∏–Ω–≥–∞
    // ‚Äî –æ–ø—ã—Ç
    let startDateObj = new Date(e.startDate);
    if (isNaN(startDateObj)) {
      const pd = e.startDate.split(/[./]/);
      if (pd.length === 3) {
        const [d, m, y] = pd;
        startDateObj = new Date(`${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`);
      }
    }
    const tenure = isNaN(startDateObj)
      ? 0
      : Math.floor((now - startDateObj) / (1000*60*60*24*30));

    // ‚Äî prime
    const primeMatch = e.prime === target ? 1 : 0;

    // ‚Äî pref
    const prefList = (e.pref || '').split(',').map(s => canonical(s));
    const prefMatch = prefList.some(pk =>
      pk === targetKey || targetKey.includes(pk) || pk.includes(targetKey)
    ) ? 1 : 0;

    // ‚Äî —è–∑—ã–∫–∏ –∏ capacity
    const langCount = e.languages.trim()
      ? e.languages.trim().split(/\s+/).length
      : 0;
    const cap = e.maxChats || 0;

    // ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π score
    const w = { t:0.2, pr:0.3, pf:0.2, lg:0.2, cp:0.1 };
    const maxCap = Math.max(...pool.map(x => x.maxChats), 1);
    const score =
      w.t  * Math.min(tenure/24, 1) +
      w.pr * primeMatch +
      w.pf * prefMatch +
      w.lg * (langCount/3) +
      w.cp * (cap/maxCap);

    return { ...e, tenure, primeMatch, prefMatch, langCount, cap, score };
  }).filter(x => x);

  if (!candidates.length) {
    $('#candidateModalBody').html(
      '<div class="alert alert-warning">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</div>'
    );
    return $('#candidateModal').modal('show');
  }

  // –≤—ã–±–∏—Ä–∞–µ–º –ª—É—á—à–µ–≥–æ
  const best = candidates.sort((a,b) => b.score - a.score)[0];

  // –≤–Ω—É—Ç—Ä–∏ findCandidate(), –ø–æ—Å–ª–µ const best = ‚Ä¶
const rec = window.shiftsQuinyxData
  .find(r => r.name.toLowerCase() === best.name.toLowerCase()) || {};

const shiftInfo = `${rec.platform || '‚Äì'} (${rec.shift || '‚Äì'})`;

let breakTime = '‚Äì';
if (Array.isArray(window.allBreaksData)) {
  const br = window.allBreaksData.find(b =>
    b.Name?.trim().toLowerCase() === best.name.trim().toLowerCase()
  );
  if (br) breakTime = br['Break Time'] || '‚Äì';
}


  // —Å–æ–±–∏—Ä–∞–µ–º HTML –¥–ª—è –º–æ–¥–∞–ª–∫–∏
  const html = `
  <div class="text-center">
    <h4>${best.name}</h4>
    <p>Score <strong>${best.score.toFixed(2)}</strong></p>
    <ul class="list-unstyled text-left mx-auto" style="max-width:200px;">
      <li>Current Shift: <strong>${shiftInfo}</strong></li>
      <li>Break: <strong>${breakTime}</strong></li>
      <li>Total working time: <strong>${best.tenure}</strong> months</li>
      <li>Is this his prime platform: <strong>${best.primeMatch ? 'Yes' : 'No'}</strong></li>
      <li>Is this his preferrable platform: <strong>${best.prefMatch ? 'Yes' : 'No'}</strong></li>
      <li>Languages: <strong>${best.langCount}</strong></li>
      <li>Chat capacity: <strong>${best.cap}</strong></li>
    </ul>
  </div>
`;

  $('#candidateModalBody').html(html);
  $('#candidateModal').modal('show');
}


        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bootstrap-Select –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º
        $(document).ready(function () {
          $("#platform-dropdown").selectpicker();
          $("#platform-dropdown").on(
            "changed.bs.select",
            function (e, clickedIndex, isSelected, previousValue) {
              let selected = $(this).val();
              currentPlatformFilter = selected && selected.length ? selected : ["all"];
              applyFilters();
            }
          );
        });

        document.getElementById("theme-checkbox")
  .addEventListener("change", toggleTheme);
document.addEventListener("DOMContentLoaded", loadThemePreference);
document.addEventListener("DOMContentLoaded", () => {
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã
  loadThemePreference();

  const dndCheckbox = document.getElementById('dnd-toggle');
  dndCheckbox.checked = doNotDisturb;
  dndCheckbox.addEventListener('change', e => {
    setDoNotDisturb(e.target.checked);
  })
  // ‚Ä¶ –æ—Å—Ç–∞–ª—å–Ω–æ–π –≤–∞—à –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏


  // –°–∞–π–¥–±–∞—Ä
  const layout    = document.querySelector(".dashboard-layout");
  const sidebar   = document.getElementById("sidebar");
  const hamburger = document.getElementById("hamburger-menu");
  const closeBtn  = document.getElementById("sidebar-close");

  // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ –ø–æ –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é
  hamburger.addEventListener("click", (e) => {
    e.stopPropagation();
    sidebar.classList.add("active");
    layout.classList.add("sidebar-open");
  });

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–Ω–æ–ø–∫–µ ¬´√ó¬ª
  closeBtn.addEventListener("click", () => {
    sidebar.classList.remove("active");
    layout.classList.remove("sidebar-open");
  });


  // –§–∏–ª—å—Ç—Ä—ã —Ç–∞–±–ª–∏—Ü—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º
  document
    .getElementById("employee-search")
    .addEventListener("input", (e) => {
      currentSearchTerm = e.target.value;
      applyFilters();
    });

  document
    .getElementById("status-filter")
    .addEventListener("change", (e) => {
      currentStatusFilter = e.target.value;
      applyFilters();
    });

  document
    .getElementById("realloc-filter")
    .addEventListener("change", (e) => {
      currentReallocFilter = e.target.value;
      applyFilters();
    });

  document
    .getElementById("lang-filter")
    .addEventListener("change", (e) => {
      currentLangFilter = e.target.value;
      applyFilters();
    });

  // –§–∏–ª—å—Ç—Ä –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
  document
    .getElementById("break-filter")
    .addEventListener("change", (e) => {
      currentBreakFilter = e.target.value; // "upcoming" –∏–ª–∏ "all"
      fetchBreaksData();
    });

  // –°–µ–ª–µ–∫—Ç–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º (bootstrap-select)
  $('#platform-dropdown').selectpicker();
  $('#platform-dropdown').on('changed.bs.select', function () {
    const selected = $(this).val();
    currentPlatformFilter = selected && selected.length ? selected : ['all'];
    applyFilters();
  });

  // –ú–æ–¥–∞–ª–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  const overlay = document.getElementById("modal-overlay");
  const modalClose = document.getElementById("modal-close");
  overlay.addEventListener("click", closeEmployeeModal);
  modalClose.addEventListener("click", closeEmployeeModal);

    // 1) –û–¥–∏–Ω —Ä–∞–∑ –∑–∞–ø–æ–ª–Ω—è–µ–º dropdown –ø–ª–∞—Ç—Ñ–æ—Ä–º
  const sel = document.getElementById('target-platform');
  // –æ—á–∏—â–∞–µ–º (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–≥–ª—É—à–∫—É)
  sel.innerHTML = '<option value="">‚Üí Reallocate to..</option>';
  platforms.forEach(p => sel.add(new Option(p.name, p.name)));

  // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
  document.getElementById("theme-checkbox").addEventListener("change", toggleTheme);

  document.getElementById('find-candidate')
  .addEventListener('click', findCandidate);

  // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  if ("Notification" in window) {
  Notification.requestPermission().then(p => {
    console.log("Push permission:", p);
  });
}

  fetchData();
});
     
      
      </script>
    </div>
  </body>
</html>
