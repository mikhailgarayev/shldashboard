<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>SUMO Dashboard</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bootstrap-Select CSS –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ dropdown -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css"
    />
    <style>
      /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
      body.hidden {
        display: none;
      }

      :root {
        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        --bg-color: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
        --text-color: #343a40;
        --card-bg-color: #ffffff;
        --card-text-color: #495057;
        --card-border-color: #dee2e6;
        --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        --card-hover-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        --menu-bg-color: #ffffff;
        --menu-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
        --menu-width: 250px;
        --transition-speed: 0.3s;
      }
      /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
      body.dark-theme {
        --bg-color: linear-gradient(120deg, #2a2a2a 0%, #3c3a3c 100%);
        --text-color: #f0f0f0;
        --card-bg-color: #3a3a3a;
        --card-text-color: #e5e5e5;
        --card-border-color: #555555;
        --card-shadow: 0 4px 16px rgba(255, 255, 255, 0.08);
        --card-hover-shadow: 0 6px 20px rgba(255, 255, 255, 0.12);
        --menu-bg-color: #3a3a3a;
      }

      /* –û–±—â–∏–π —Å–±—Ä–æ—Å –∏ —Ñ–æ–Ω */
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        min-height: 100vh;
        background: var(--bg-color);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow-x: hidden;
        color: var(--text-color);
        transition: background var(--transition-speed) ease,
          color var(--transition-speed) ease;
      }

      /* –°—Ç–∏–ª—å –¥–ª—è –±–ª–æ–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –∫–Ω–æ–ø–∫–æ–π –≤—ã—Ö–æ–¥–∞ */
      #user-info {
        text-align: right;
        padding: 10px;
        font-size: 1rem;
        color: var(--text-color);
      }

      /* –°–∞–π–¥–±–∞—Ä (–º–µ–Ω—é) */
      .hamburger-menu {
        margin-right: 12px;
        cursor: pointer;
      }
      .hamburger-menu span {
        font-size: 28px;
        color: var(--text-color);
      }
      #sidebar {
        position: fixed;
        top: 0;
        left: -250px;
        width: var(--menu-width);
        height: 100%;
        background: var(--menu-bg-color);
        box-shadow: var(--menu-shadow);
        transition: left var(--transition-speed) ease;
        z-index: 1099;
        padding-top: 20px;
        padding-left: 15px;
        padding-right: 15px;
      }
      #sidebar.active {
        left: 0;
      }
      #sidebar .close-btn {
        display: block;
        text-align: right;
        font-size: 24px;
        cursor: pointer;
        margin-bottom: 10px;
        color: var(--text-color);
      }
      #sidebar a {
        display: block;
        padding: 10px 5px;
        color: var(--text-color);
        text-decoration: none;
        border-bottom: 1px solid var(--card-border-color);
      }
      #sidebar a:hover {
        background-color: var(--bg-color);
      }

      .dashboard-container {
        width: 100%;
        margin: 0;
        padding: 20px;
        box-sizing: border-box;
      }
      h1 {
        text-align: center;
        margin-bottom: 20px;
        font-weight: 500;
        font-size: 2rem;
        color: var(--text-color);
      }

      /* –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
      .filter-panel {
        background: var(--card-bg-color);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        box-shadow: var(--card-shadow);
      }
      .stats-card {
        padding: 10px 15px;
        background: var(--bg-color);
        border-radius: 8px;
        border: 1px solid var(--card-border-color);
        min-width: 180px;
      }
      .stats-title {
        font-size: 0.9rem;
        opacity: 0.7;
      }
      .stats-value {
        font-weight: bold;
        font-size: 1.2rem;
        margin-top: 4px;
      }
      .filter-section {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .filter-dropdown {
        padding: 8px 12px;
        border: 1px solid var(--card-border-color);
        border-radius: 6px;
        background: var(--card-bg-color);
        min-width: 120px;
        color: var(--text-color);
      }
      .search-section {
        display: flex;
        margin-left: auto;
      }
      .search-input {
        padding: 8px 12px;
        border: 1px solid var(--card-border-color);
        border-radius: 6px 0 0 6px;
        background: var(--card-bg-color);
        width: 150px;
        color: var(--text-color);
      }

      /* –°–µ–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
      .refresh-section {
        margin-left: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .refresh-btn {
        padding: 6px 10px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .refresh-btn:hover {
        background-color: #218838;
      }
      .spinner-border {
        width: 1rem;
        height: 1rem;
        border-width: 0.1em;
      }

      /* –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
      .theme-text {
        margin: 0;
        padding: 0;
        line-height: 1;
        font-size: 1rem;
      }
      /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
      .theme-toggle-container {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .theme-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }
      .theme-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }
      .slider:before {
        position: absolute;
        content: "‚òÄÔ∏è";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
        font-size: 12px;
        line-height: 18px;
        text-align: center;
        color: #f39c12;
      }
      input:checked + .slider {
        background-color: #007bff;
      }
      input:checked + .slider:before {
        transform: translateX(26px);
        content: "üåô";
        color: #f1c40f;
      }

      /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏ —Ç–∞–±–ª–∏—Ü—ã */
      .platforms-row {
        display: flex;
        flex-wrap: nowrap;
        align-items: flex-start;
        justify-content: space-between;
        overflow-x: auto;
        gap: 10px;
      }
      .platform-card {
        flex: 1 1 220px;
        min-width: 220px;
        background: var(--card-bg-color);
        color: var(--card-text-color);
        border-radius: 16px;
        padding: 20px;
        box-shadow: var(--card-shadow);
        transition: transform 0.2s, box-shadow 0.2s;
        overflow-wrap: break-word;
      }
      .platform-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--card-hover-shadow);
      }
      .platform-card h5 {
        text-align: center;
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 12px;
        color: var(--text-color);
      }
      .platform-card h5 .info-icon {
        display: inline-block;
        margin-left: 5px;
        cursor: pointer;
        font-size: 0.9rem;
        vertical-align: middle;
      }
      .platform-card p {
        text-align: center;
        margin: 10px 0;
        font-size: 0.85rem;
        color: #6c757d;
      }
      .platform-card ul {
        list-style: none;
        padding-left: 0;
        font-size: 0.85rem;
        color: var(--card-text-color);
      }
      .platform-card ul li {
        padding: 4px 0;
        cursor: pointer;
        border-bottom: 1px solid var(--card-border-color);
      }
      .platform-card ul li:last-child {
        border-bottom: none;
      }
      .shift-summary-card {
        background: none !important;
        color: var(--card-text-color);
        border: none !important;
        box-shadow: none !important;
        padding: 20px;
        margin: 0 auto 40px;
        text-align: center;
        overflow-wrap: break-word;
        color: #f8f9fa;
        font-size: 1.2rem;
        font-weight: 700;
      }
      .shift-summary-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--card-hover-shadow);
      }
      .shift-summary-title {
        margin-bottom: 16px;
        font-weight: 600;
        font-size: 1.3rem;
        color: var(--text-color);
      }
      .shift-summary-grid {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        table-layout: auto;
        font-size: 2rem;
      }
      .shift-summary-grid th,
      .shift-summary-grid td {
        padding: 8px 12px;
        text-align: center;
        font-size: 0.85rem;
        color: var(--card-text-color);
      }
      .shift-summary-grid th {
        background: none !important;
        font-weight: 600;
      }
      .shift-summary-grid td {
        background: none !important;
        border: 1px solid var(--card-border-color);
        border-radius: 8px;
      }
      .small-font-card {
        font-size: 0.9rem;
      }
      .shift-card-title {
        font-size: 1.4rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        text-align: center;
      }
      .shift-card-away {
        font-size: 1.1rem;
        color: #666;
        text-align: center;
      }
      #breaks-section {
        margin-top: 40px;
      }
      #breaks-section h2 {
        text-align: center;
        margin-bottom: 20px;
        font-weight: 500;
        font-size: 1.5rem;
        color: var(--text-color);
      }
      .break-card {
        background: var(--card-bg-color);
        color: var(--card-text-color);
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        padding: 20px;
        margin: 0 auto 40px;
        max-width: 600px;
        text-align: center;
        overflow-wrap: break-word;
      }
      .break-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--card-hover-shadow);
      }
      .break-card h5 {
        margin-bottom: 12px;
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--text-color);
      }
      .break-card ul {
        list-style: none;
        padding-left: 0;
        font-size: 0.85rem;
        color: var(--card-text-color);
      }
      .break-card ul li {
        padding: 6px 0;
        border-bottom: 1px solid var(--card-border-color);
      }
      .break-card ul li:last-child {
        border-bottom: none;
      }

      /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ */
      #modal-overlay {
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        position:fixed;
        top : 0;
        left: 0;  
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }
      #employee-modal {
        opacity: 0;
        transform: translateX(-50%) scale(0.95);
        transition: opacity 0.3s ease, transform 0.3s ease;
        position: fixed;
        top: 20%;
        left: 50%;
        background: var(--card-bg-color);
        color: var(--card-text-color);
        border: 1px solid var(--card-border-color);
        box-shadow: var(--card-shadow);
        border-radius: 8px;
        padding: 20px;
        z-index: 1001;
        width: 330px;
        pointer-events: none;
      }

      #employee-modal.show {
        opacity: 1;
        transform: translateX(-50%) scale(1);
        pointer-events: auto;
      }

      #modal-overlay.show {
        opacity: 1;
        pointer-events: auto;
      }

      #employee-modal h3 {
        margin: 0 0 8px 0;
      }
      #employee-modal .close-btn {
        position: absolute;
        top: 8px;
        right: 12px;
        cursor: pointer;
        font-size: 20px;
      }
      #employee-modal a {
        color: #007bff;
        text-decoration: underline;
      }
      #employee-modal a:hover {
        color: #0056b3;
      }
      .dashboard-header {
        background: var(--card-bg-color);
        border-bottom: 1px solid var(--card-border-color);
        box-shadow: var(--card-shadow);
        border-radius: 0 0 12px 12px;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .filters-wrapper {
        flex: 1 1 auto;
        min-width: 0;
        max-width: 100%;
      }
      .filters-wrapper select,
      .filters-wrapper input {
        flex-shrink: 0;
      }
      @media (max-width: 768px) {
        .filters-wrapper {
          flex-direction: column;
          align-items: stretch;
        }
        .filters-wrapper > * {
          width: 100%;
        }
      }
      .header-gap > * {
        margin-right: 10px;
        margin-bottom: 6px;
      }
      .header-gap > *:last-child {
        margin-right: 0;
      }
      .info-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
        margin-bottom: 20px;
      }

      /* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –¥–ª—è –ø–æ–ª—è Platform, –∏—Å–ø–æ–ª—å–∑—É–µ–º bootstrap‚Äëselect */
      .bootstrap-select .dropdown-toggle {
        width: 120px !important;
        padding: 4px 8px !important;
        font-size: 0.9rem !important;
        height: auto;
        line-height: 1.2  !important;
      }
      .btn-outline-primary:hover {
        color: white !important;
        background-color: #007bff !important;
        border-color: #007bff !important;
      }

      body.dark-theme #employee-modal {
  background-color: #2b2b2b;
  color: #f0f0f0;
  border: 1px solid #444;
}

body.dark-theme #employee-modal h5 {
  color: #fff;
}

body.dark-theme #employee-modal small {
  color: #aaa;
}

body.dark-theme #employee-modal strong {
  color: #ddd;
}

body.dark-theme #employee-modal a,
body.dark-theme #employee-modal .btn-outline-primary {
  color: #66b0ff;
  border-color: #66b0ff;
}

body.dark-theme #employee-modal .btn-outline-primary:hover {
  background-color: #66b0ff;
  color: white;
}

.break-overdue {
  color: #dc3545; /* Bootstrap red */
  font-weight: bold;
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.6;
    transform: scale(1.05);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}
    </style>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script>
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyAHyxC12UaO6QU_nCiWFnegul1Vix5skm8",
        authDomain: "shldashboard.firebaseapp.com",
        projectId: "shldashboard",
        storageBucket: "shldashboard.firebasestorage.app",
        messagingSenderId: "362566153595",
        appId: "1:362566153595:web:ee35c2588bd0f798e6f9de"
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();

      // –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö email
      const allowedEmails = [
        "mikhail.garayev@wolt.com",
        "elshan.tahmazov@wolt.com",
        "inara.mammadzada@wolt.com",
        "mayya.mirzayeva@wolt.com",
        "mikayil.alizada@wolt.com",
        "pasha.chiragov@wolt.com",
        "rahim.mammadov@wolt.com",
        "toghrul.mirzali@wolt.com",
        "amaliya.rizvanova@wolt.com",
        "anar.mikayilov@wolt.com",
        "arif.guliyev@wolt.com",
        "farid.hajiyev@wolt.com",
        "naziya.orujova@wolt.com",
        "rafig.huseynov@wolt.com",
        "sama.akbarzadegan@wolt.com",
        "mursal.askarov@wolt.com"
      ];

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äì –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –µ–≥–æ email –Ω–µ —Ä–∞–∑—Ä–µ—à—ë–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ login.html
      auth.onAuthStateChanged((user) => {
        if (!user || !allowedEmails.includes(user.email)) {
          window.location.replace("login.html");
        } else {
          // –ï—Å–ª–∏ –≤—Å–µ –æ–∫, –≤—ã–≤–æ–¥–∏–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å hidden
          document.getElementById("user-display-name").textContent =
            user.displayName || user.email;
          document.body.classList.remove("hidden");
        }
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Log Out
      document.addEventListener("DOMContentLoaded", () => {
        const logoutBtn = document.getElementById("logout-btn");
        logoutBtn.addEventListener("click", () => {
          auth.signOut();
        });
      });
    </script>
  </head>
  <body class="hidden">
    <header
      class="dashboard-header d-flex flex-wrap align-items-center justify-content-between gap-3 px-3 py-2"
    >
      <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –±—É—Ä–≥–µ—Ä + –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
      <div class="d-flex align-items-center gap-3">
        <div class="hamburger-menu" id="hamburger-menu">
          <span style="font-size: 24px; cursor: pointer;">‚ò∞</span>
        </div>
        <h1 class="mb-0" style="font-size: 1.3rem;">
          Support Monitoring Dashboard
        </h1>
      </div>

      <!-- –¶–µ–Ω—Ç—Ä: —Ñ–∏–ª—å—Ç—Ä—ã -->
      <div
        class="filters-wrapper d-flex flex-wrap align-items-center flex-grow-1 justify-content-center header-gap"
      >
        <select id="status-filter" class="filter-dropdown">
          <option value="both">Status</option>
          <option value="active">Active</option>
          <option value="away">Away</option>
        </select>
        <!-- –ù–æ–≤—ã–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π dropdown —Å –ø–æ–º–æ—â—å—é Bootstrap-Select –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º -->
        <select
          id="platform-dropdown"
          class="selectpicker filter-dropdown"
          multiple
          data-live-search="true"
          title="Platform"
          data-width="140px"
        >
          <option value="all" selected>All platforms</option>
          <option value="CS">CS</option>
          <option value="CS/Post order">CS/Post order</option>
          <option value="PSR">PSR</option>
          <option value="SiMo">SiMo</option>
          <option value="Aircall">Aircall</option>
          <option value="Venue">Venue</option>
          <option value="Trainee">Trainee</option>
          <option value="ST">ST</option>
        </select>
        <select id="realloc-filter" class="filter-dropdown">
          <option value="all">Reallocate: All</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
        <select id="lang-filter" class="filter-dropdown">
          <option value="all">Language: All</option>
          <option value="two">Bilingual</option>
          <option value="three">Trilingual</option>
        </select>
        <select id="break-filter" class="filter-dropdown">
          <option value="upcoming">Breaks: Upcoming</option>
          <option value="all">Breaks: All</option>
        </select>
        <input
          type="text"
          id="employee-search"
          placeholder="Search..."
          class="search-input"
        />
      </div>

      <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: —Ç–µ–º–∞ + refresh + –∏–º—è + logout -->
      <div class="d-flex align-items-center flex-wrap header-gap">
        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
        <div class="d-flex align-items-center gap-2">
          <span>Theme:</span>
          <label class="theme-switch mb-0" style="margin-left: 8px;">
            <input type="checkbox" id="theme-checkbox" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="refresh-section d-flex align-items-center gap-2">
          <span id="timer-label"
            >Refresh in: <span id="countdown">15</span>s</span
          >
          <div
            style="width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;"
          >
            <div
              id="refresh-spinner"
              class="spinner-border text-primary"
              role="status"
              style="display:none;"
            >
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <button
            class="refresh-btn btn btn-sm btn-success"
            onclick="refreshNow()"
          >
            Refresh now
          </button>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span id="user-display-name" class="small text-muted"></span>
          <button
            id="logout-btn"
            class="btn btn-sm btn-outline-secondary"
            style="margin-left: 8px;"
          >
            Log Out
          </button>
        </div>
      </div>
    </header>

    <!-- –°–∞–π–¥–±–∞—Ä —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π -->
    <div id="sidebar">
      <div class="close-btn" id="sidebar-close">&times;</div>
      <a href="https://example.com" target="_blank">YIGIM Dashboard</a>
      <a href="https://anotherexample.com" target="_blank">Datadog Dashboard</a>
      <a href="https://yetanother.com" target="_blank">City States</a>
      <a href="https://yetanother.com" target="_blank">City Tools</a>
      <a href="https://yetanother.com" target="_blank">Converse Admin Panel</a>
    </div>

    <div class="dashboard-container">
      <div class="info-cards d-flex flex-wrap gap-3 my-3 px-3">
        <div class="stats-card" id="weather-card">
          <span class="stats-title">Baku Weather</span>
          <span class="stats-value" id="baku-temp">-- ¬∞C</span><br />
          <span class="stats-title">Wind Speed</span>
          <span class="stats-value" id="baku-wind">-- m/s</span>
        </div>
        <div class="stats-card">
          <div class="stats-title">Baku Central</div>
          <div class="stats-value">0.0</div>
        </div>
        <div class="stats-card">
          <div class="stats-title">Ganja</div>
          <div class="stats-value">0.0</div>
        </div>
        <div class="stats-card">
          <div class="stats-title">Lankaran</div>
          <div class="stats-value">0.0</div>
        </div>
        <div class="stats-card">
          <div class="stats-title">Mingachevir</div>
          <div class="stats-value">0.0</div>
        </div>
        <div class="stats-card">
          <div class="stats-title">Nakchivan</div>
          <div class="stats-value">0.0</div>
        </div>
      </div>

      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
      <div id="shift-summary" class="shift-summary-card">
        <div class="shift-summary-title">Metrics per platform</div>
        <table class="shift-summary-grid" id="summary-table"></table>
      </div>

      <div id="platforms-container" class="platforms-row"></div>

      <div id="breaks-section">
        <h2>Breaks</h2>
        <div id="breaks-app"></div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
    <div id="modal-overlay"></div>
    <div
      id="employee-modal">
    <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px 20px 0 20px;">
      <div style="display: flex; align-items: center;">
        <img 
          id="modal-emp-avatar" 
          src="https://i.ibb.co/YrbxqCn/favicon.jpg" 
          alt="Avatar" 
          style="width: 60px; height: 60px; border-radius: 50%; margin-right: 15px;"
        />
        <div>
          <h5 id="modal-emp-name" style="margin: 0; font-weight: 600;">Employee Name</h5>
          <small id="modal-emp-email" style="color: #888;">employee.email@wolt.com</small>
        </div>
      </div>
      <span class="close-btn" id="modal-close" style="cursor: pointer; font-size: 24px; color: #999;">&times;</span>
    </div>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div style="padding: 15px 20px 0 20px; text-align: left;">
      <div style="margin-bottom: 10px;">
        <strong>Role:</strong> <span id="modal-emp-role">Support Associate</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Prime platform:</strong> <span id="modal-emp-prime">CS</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Preferred platform:</strong> <span id="modal-emp-pref">PSR</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Can reallocate?:</strong> <span id="modal-emp-realloc">Yes</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Language:</strong> <span id="modal-emp-languages">AZ RUGB</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Shift:</strong> <span id="modal-emp-shift">‚Äî</span>
      </div>
      <div style="margin-bottom: 10px;">
        <strong>Break:</strong> <span id="modal-emp-break">‚Äî</span>
      </div>      
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div style="padding: 20px; text-align: right;">
      <button id="modal-inbox-link" class="btn btn-primary" style="margin-right: 10px;">Open Inbox</button>
      <button id="modal-admin-link" class="btn btn-outline-primary">Admin Panel</button>
    </div>
    
      
      <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º jQuery, Bootstrap JS –∏ Bootstrap-Select JS -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>

      <script>
        // ===============================
        // WEATHER SECTION WITH CACHING & EMOJI
        const OPENWEATHER_API_KEY = "f97220cfb6bcefa391405990e7b9825d";
        const CITY_NAME = "Baku,AZ";
        async function fetchWeather() {
          const cacheKey = "bakuWeatherData";
          const cacheTimeKey = "bakuWeatherTimestamp";
          const now = Date.now();
          const cacheTTL = 15 * 60 * 1000; // 15 –º–∏–Ω—É—Ç

          const cachedData = localStorage.getItem(cacheKey);
          const cachedTimestamp = localStorage.getItem(cacheTimeKey);

          if (cachedData && cachedTimestamp && now - cachedTimestamp < cacheTTL) {
            const data = JSON.parse(cachedData);
            updateWeatherUI(data);
            return;
          }

          const url = `https://api.openweathermap.org/data/2.5/weather?q=${CITY_NAME}&units=metric&appid=${OPENWEATHER_API_KEY}`;
          try {
            const res = await fetch(url);
            if (!res.ok) {
              console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã: " + res.statusText);
              return;
            }
            const data = await res.json();
            localStorage.setItem(cacheKey, JSON.stringify(data));
            localStorage.setItem(cacheTimeKey, now);
            updateWeatherUI(data);
          } catch (err) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–≥–æ–¥—ã: " + err);
          }
        }
        function updateWeatherUI(data) {
          const temperature = data.main?.temp ?? null;
          const windSpeed = data.wind?.speed ?? null;
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–≥–æ–¥–Ω—ã–π —Å–º–∞–π–ª–∏–∫
          let weatherEmoji = "";
          if (data.weather && data.weather.length > 0) {
            const condition = data.weather[0].main;
            switch (condition) {
              case "Clear":
                weatherEmoji = "‚òÄÔ∏è";
                break;
              case "Clouds":
                weatherEmoji = "‚òÅÔ∏è";
                break;
              case "Rain":
              case "Drizzle":
                weatherEmoji = "üåßÔ∏è";
                break;
              case "Thunderstorm":
                weatherEmoji = "‚õàÔ∏è";
                break;
              case "Snow":
                weatherEmoji = "‚ùÑÔ∏è";
                break;
              default:
                weatherEmoji = "";
                break;
            }
          }

          document.getElementById("baku-temp").textContent =
            temperature ? `${Math.round(temperature)} ¬∞C ${weatherEmoji}` : "-- ¬∞C";
          document.getElementById("baku-wind").textContent =
            windSpeed ? `${windSpeed} m/s` : "-- m/s";
        }
        // ===============================

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º
        const platformInfo = {
          "CS":
            "Click on the link to open the CS platform.\nClick on employee name to open their profile.",
          "CS/Post order":
            "Click on the link to open the CS PO AZE platform.\nClick on employee name to open their profile.",
          PSR: "Click on the link to open the PSR platform.\nClick on employee name to open their profile.",
          SiMo: "Click on the link to open the Support Inbox.\nClick on employee name to open their profile.",
          Aircall:
            "Click on the link to open the CS platform.\nClick on employee name to open their profile.\n You can see employee's status in the Aircall.",
          Venue:
            "Click on the link to open the Venue platform.\nClick on employee name to open their profile.",
          Trainee: "Click on employee name to open their profile.",
          ST: "Click on employee name to open their profile."
        };

        let fetchedData = null;
        let currentSearchTerm = "";
        let currentStatusFilter = "both";
        let currentPlatformFilter = ["all"];
        let currentReallocFilter = "all";
        let currentLangFilter = "all";
        let currentBreakFilter = "upcoming";

        const SPREADSHEET_ID = "1dICKOxxz9R3x8MY3FKQ9I-IwR9fBUDfMOT9PFDLloAE";
        const SHIFT_RANGE = "list1!AT5:BH47";
        const RANGE = "list1!A1:BJ100";
        const RESPONSIBLES_RANGE = "list1!B5:C27";
        const BREAKS_RANGE = "prebreaks!A1:D40";
        const GOOGLE_API_KEY = "AIzaSyBVHrKvA61CAJBLxU-4AAiow6Y0TV4ChSY";

        let employeeData = {};

        const platforms = [
          {
            name: "CS",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=6643245bfadf62c6edc28feb",
            colIndexNames: 3,
            colIndexData: 4,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "CS/Post order",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=664324a0510ac011feaa798c",
            colIndexNames: 5,
            colIndexData: 6,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "PSR",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=6567a44af7d470550b11dc68",
            colIndexNames: 7,
            colIndexData: 8,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "SiMo",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=6668088fc6d870f3cfd61653",
            colIndexNames: 9,
            colIndexData: 10,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "Aircall",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=671a26a2a5b9ae4a2ca603fb",
            colIndexNames: 11,
            colIndexData: 12,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "Venue",
            url: "https://ops.wolt.com/support/converse/conversations?conversationListId=666807fc28b3f1231948f407",
            colIndexNames: 13,
            colIndexData: 14,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "Trainee",
            url: "https://wolt.com/",
            colIndexNames: 15,
            colIndexData: 16,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          },
          {
            name: "ST",
            url: "https://wolt.com/",
            colIndexNames: 17,
            colIndexData: 18,
            rowActiveNamesStart: 4,
            rowActiveNamesEnd: 27,
            rowAwayNamesStart: 28,
            rowAwayNamesEnd: 47
          }
        ];

        let aircallActive = [];
        let aircallAway = [];

        function logDebug(message) {
          console.log(message);
        }

        async function fetchSheetData(range) {
          const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(
            range
          )}?key=${GOOGLE_API_KEY}`;
          try {
            const res = await fetch(url);
            if (!res.ok) {
              logDebug("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: " + res.statusText);
              return null;
            }
            const data = await res.json();
            return data.values;
          } catch (err) {
            logDebug("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: " + err);
            return null;
          }
        }

        async function fetchEmployeeList() {
          const data = await fetchSheetData("emplist!A1:F");
          if (!data || data.length < 2) return;
          for (let i = 1; i < data.length; i++) {
            const row = data[i];
            if (!row[0]) continue;
            const empName = row[0].trim();
            const empId = row[1]?.trim() || "";
            const canRealloc = row[2]?.trim() || "";
            const primePlatform = row[3]?.trim() || "";
            const preferredPlatform = row[4]?.trim() || "";
            const languages = row[5]?.trim() || "";
            employeeData[empName] = {
              id: empId,
              canReallocate: canRealloc,
              prime: primePlatform,
              pref: preferredPlatform,
              languages: languages
            };
          }
        }

        function generateInboxLink(empId) {
          return (
            "https://ops.wolt.com/support/converse/users/conversations?assigneeIds=" +
            encodeURIComponent(empId)
          );
        }

        function generateAdminLink(empId) {
          return (
            "https://ops.wolt.com/support/converse/admin/users?userId=" +
            encodeURIComponent(empId)
          );
        }

        function openEmployeeModal(empName) {
          const info = employeeData[empName];
          if (!info) {
            logDebug("–î–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã: " + empName);
            return;
          }
          // –ü–æ–ª—É—á–∞–µ–º —Å–º–µ–Ω—É
          let shift = "‚Äî";

            if (window.allShiftData && Array.isArray(window.allShiftData)) {
              for (const row of window.allShiftData) {
                for (const cell of row) {
                  if (typeof cell === "string" && cell.toLowerCase().includes(empName.toLowerCase())) {
                    // –ë–µ—Ä—ë–º –≤—Å—ë, —á—Ç–æ –¥–æ ¬´- –∏–º—è¬ª, —Ç.–µ. –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–∏–Ω—É—Å–∞
                    const dashindex = cell.lastIndexOf(" - ");
                    if (dashindex !== -1) {
                      shift = cell.substring(0, dashindex).trim(); 
                    } else {
                      shift = cell.trim(); // fallback ‚Äî –≤—Å—è —Å—Ç—Ä–æ–∫–∞
                    }
                    break;
                  }
                }
                if (shift !== "‚Äî") break;
              }
            }
          let breakTime = "‚Äî";
            if (window.allBreaksData && Array.isArray(window.allBreaksData)) {
              const foundBreak = allBreaksData.find(b => b["Name"]?.trim().toLowerCase() === empName.trim().toLowerCase());
              if (foundBreak) {
                breakTime = foundBreak["Break Time"] || "‚Äî";
              }
            }
          document.getElementById("modal-emp-break").textContent = breakTime;

          document.getElementById("modal-emp-shift").textContent = shift;
          const parts = empName.trim().split(" ");
          const email = parts.length >= 2 ? `${parts[0].toLowerCase()}.${parts[1].toLowerCase()}@wolt.com` : `${parts[0].toLowerCase()}@wolt.com`;
          document.getElementById("modal-emp-name").textContent = empName;
          document.getElementById("modal-emp-email").textContent = email;
          document.getElementById("modal-emp-realloc").textContent =
            info.canReallocate || "N/A";
          document.getElementById("modal-emp-prime").textContent =
            info.prime || "N/A";
          document.getElementById("modal-emp-pref").textContent =
            info.pref || "N/A";
          document.getElementById("modal-emp-languages").textContent =
            info.languages || "N/A";
          document.getElementById("modal-inbox-link").onclick = () => {
            window.open(generateInboxLink(info.id), "_blank");
          };
          document.getElementById("modal-admin-link").onclick = () => {
            window.open(generateAdminLink(info.id), "_blank");
          };
          document.getElementById("employee-modal").classList.add("show");
          document.getElementById("modal-overlay").classList.add("show");
        }

        function closeEmployeeModal() {
          document.getElementById("employee-modal").classList.remove("show");
          document.getElementById("modal-overlay").classList.remove("show");
        }

        const AIRCALL_API_KEY = "43bce092d80a09050211a837c0bbd705";
        const AIRCALL_API_SECRET = "092d2eb157c47614788386920acd7413";

        async function getAircallUserId(email) {
          const authString = btoa(`${AIRCALL_API_KEY}:${AIRCALL_API_SECRET}`);
          const url = `https://api.aircall.io/v1/users/${encodeURIComponent(
            email
          )}`;
          try {
            logDebug(`–ó–∞–ø—Ä–æ—Å Aircall ID –¥–ª—è email: ${email}`);
            const res = await fetch(url, {
              headers: { Authorization: `Basic ${authString}` }
            });
            if (!res.ok) {
              logDebug(
                `–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è ID Aircall: ${res.statusText} (–°—Ç–∞—Ç—É—Å: ${res.status})`
              );
              return null;
            }
            const data = await res.json();
            logDebug(`–ü–æ–ª—É—á–µ–Ω ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${data.user?.id}`);
            return data.user?.id || null;
          } catch (err) {
            logDebug("–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ Aircall ID: " + err);
            return null;
          }
        }

        async function getAircallAvailability(userId) {
          if (!userId) {
            logDebug("getAircallAvailability: userId –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω");
            return "No ID";
          }
          const authString = btoa(`${AIRCALL_API_KEY}:${AIRCALL_API_SECRET}`);
          const url = `https://api.aircall.io/v1/users/${userId}/availability`;
          try {
            logDebug(`–ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ Aircall –¥–ª—è userId: ${userId}`);
            const res = await fetch(url, {
              headers: { Authorization: `Basic ${authString}` }
            });
            if (!res.ok) {
              logDebug(
                `–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ Aircall: ${res.statusText} (–°—Ç–∞—Ç—É—Å: ${res.status})`
              );
              return "Error";
            }
            const data = await res.json();
            let status =
              data?.user_availability?.availability_status || data?.availability;
            logDebug(`–ü–æ–ª—É—á–µ–Ω —Å—Ç–∞—Ç—É—Å –¥–ª—è userId ${userId}: ${status}`);
            return status || "Unknown";
          } catch (err) {
            logDebug("–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ getAircallAvailability: " + err);
            return "Error";
          }
        }

        function passReallocAndLang(empName) {
          const info = employeeData[empName];
          if (!info) return false;
          if (currentReallocFilter !== "all") {
            if (info.canReallocate !== currentReallocFilter) return false;
          }
          if (currentLangFilter !== "all") {
            let lang = info.languages.replace(/\s+/g, "");
            if (currentLangFilter === "two") {
              if (!(lang.includes("üá¶üáø") && lang.includes("üá¨üáß")) || lang.includes("üá∑üá∫")) {
                return false;
              }
            } else if (currentLangFilter === "three") {
              if (!(lang.includes("üá¶üáø") && lang.includes("üá¨üáß") && lang.includes("üá∑üá∫"))) {
                return false;
              }
            }
          }
          return true;
        }

        function applyFilters() {
          const container = document.getElementById("platforms-container");
          container.innerHTML = "";

          platforms.forEach((platform) => {
            if (
              !currentPlatformFilter.includes("all") &&
              !currentPlatformFilter.includes(platform.name)
            ) {
              return;
            }

            if (platform.name !== "Aircall") {
              let activeNames = [];
              for (
                let r = platform.rowActiveNamesStart;
                r <= platform.rowActiveNamesEnd;
                r++
              ) {
                const nm = fetchedData[r]?.[platform.colIndexNames]?.trim();
                if (nm) activeNames.push(nm);
              }
              let awayData = [];
              for (
                let r = platform.rowAwayNamesStart;
                r <= platform.rowAwayNamesEnd;
                r++
              ) {
                const nm = fetchedData[r]?.[platform.colIndexNames]?.trim();
                if (!nm) continue;
                const rsn = fetchedData[r]?.[platform.colIndexData]?.trim() || "";
                awayData.push({ name: nm, reason: rsn });
              }
              if (currentSearchTerm) {
                activeNames = activeNames.filter((n) =>
                  n.toLowerCase().includes(currentSearchTerm.toLowerCase())
                );
                awayData = awayData.filter((item) =>
                  item.name.toLowerCase().includes(currentSearchTerm.toLowerCase())
                );
              }
              activeNames = activeNames.filter((n) => passReallocAndLang(n));
              awayData = awayData.filter((item) => passReallocAndLang(item.name));

              let showActive = true,
                showAway = true;
              if (currentStatusFilter === "active") showAway = false;
              else if (currentStatusFilter === "away") showActive = false;

              let html = `<div class="platform-card">
                        <h5>
                          <a href="${platform.url}" target="_blank" rel="noopener" title="Click to navigate to ${platform.name}" style="vertical-align: middle;">
                            ${platform.name}
                          </a>
                          <span class="info-icon" data-toggle="tooltip" title="${
                            platformInfo[platform.name] || ""
                          }" style="display: inline-block; vertical-align: middle; margin-left: 6px;">
                            <img src="https://www.svgrepo.com/show/474873/info.svg" alt="Info" style="width:16px; height:16px; cursor:pointer; vertical-align:middle;" />
                          </span>
                        </h5>`;
              if (showActive) {
                if (activeNames.length === 0) {
                  html += `<p><small style="color: red; font-weight: bold;">Active (0)</small>
                          <span data-toggle="tooltip" title="–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤" style="color: red; margin-left: 5px; cursor: pointer; font-size: 1.5rem;">&#9888;</span>
                        </p>`;
                } else {
                  html += `<p><small>Active (${activeNames.length})</small></p><ul>`;
                  activeNames.forEach((n) => {
                    html += `<li class="employee-item" data-employee="${n}">${n}</li>`;
                  });
                  html += `</ul>`;
                }
              }
              if (showAway) {
                html += `<p><small>Away (${awayData.length})</small></p><ul>`;
                  awayData.forEach((item) => {
                    let reasonText = item.reason || "";
                    let reasonClass = "";

                    if (reasonText.includes("Break")) {
                      const match = reasonText.match(/-([0-9]+):([0-9]{2})/);
                      if (match) {
                        reasonClass = "break-overdue"; // –ø—Ä–∏–º–µ–Ω–∏–º –∞–Ω–∏–º–∞—Ü–∏—é
                      }
                    }

                    html += `<li class="employee-item ${reasonClass}" data-employee="${item.name}">${item.name}`;
                    if (reasonText) html += ` (${reasonText})`;
                    html += `</li>`;
                  });

                html += `</ul>`;
              }
              html += `</div>`;
              container.innerHTML += html;
            } else {
              // –î–ª—è Aircall –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
              let filteredActive = aircallActive.slice().filter(
                (n) => n.toLowerCase() !== "away"
              );
              let filteredAway = aircallAway.slice().filter(
                (item) => item.name.toLowerCase() !== "away"
              );
              if (currentSearchTerm) {
                filteredActive = filteredActive.filter((n) =>
                  n.toLowerCase().includes(currentSearchTerm.toLowerCase())
                );
                filteredAway = filteredAway.filter((item) =>
                  item.name.toLowerCase().includes(currentSearchTerm.toLowerCase())
                );
              }
              filteredActive = filteredActive.filter((n) => passReallocAndLang(n));
              filteredAway = filteredAway.filter((item) =>
                passReallocAndLang(item.name)
              );

              let showActive = true,
                showAway = true;
              if (currentStatusFilter === "active") showAway = false;
              else if (currentStatusFilter === "away") showActive = false;
              renderAircallCardWithStatuses(filteredActive, filteredAway, showActive, showAway);
            }
          });

          const employeeItems = document.querySelectorAll(".employee-item");
          employeeItems.forEach((item) => {
            item.addEventListener("click", function () {
              const empName = this.getAttribute("data-employee");
              openEmployeeModal(empName);
            });
          });

          $('[data-toggle="tooltip"]').tooltip();
        }

        function renderAircallCardWithStatuses(
          activeList,
          awayList,
          showActive = true,
          showAway = true
        ) {
          const aircallPlatform = platforms.find((p) => p.name === "Aircall");
          let html = `<div class="platform-card">
                    <h5>
                      <a href="${aircallPlatform.url}" target="_blank" rel="noopener" title="Click to navigate to Snooze inbox" style="vertical-align: middle;">
                        Aircall
                      </a>
                      <span class="info-icon" data-toggle="tooltip" title="${
                        platformInfo["Aircall"] || ""
                      }" style="display: inline-block; vertical-align: middle; margin-left: 6px;">
                          <img src="https://www.svgrepo.com/show/474873/info.svg" alt="Info" style="width:16px; height:16px; cursor:pointer; vertical-align:middle;" />
                        </span>
                    </h5>`;
          if (showActive) {
            if (activeList.length === 0) {
              html += `<p><small style="color: red; font-weight: bold;">Active (0)</small>
                        <span data-toggle="tooltip" title="No active employees" style="color: red; margin-left: 5px; cursor: pointer; font-size: 1.5rem;">&#9888;</span>
                      </p>`;
            } else {
              html += `<p><small>Active (${activeList.length})</small></p>
                       <ul id="aircall-active-list">` +
                activeList
                  .map((n, index) => {
                    const safeId = `aircall-active-${index}`;
                    return `<li id="${safeId}" class="employee-item" data-employee="${n}">${n} - <span style="color: green;">Checking status...</span></li>`;
                  })
                  .join("") +
                `</ul>`;
            }
          }
          if (showAway) {
            html += `<p><small>Away (${awayList.length})</small></p>
                     <ul>` +
              awayList
                .map((a) => {
                  const extra = a.reason ? " - " + a.reason : "";
                  return `<li class="employee-item" data-employee="${a.name}">${a.name}${extra}</li>`;
                })
                .join("") +
              `</ul>`;
          }
          html += `</div>`;
          document.getElementById("platforms-container").innerHTML += html;
        }

        function renderShiftSummary(data) {
          const tableEl = document.getElementById("summary-table");
          tableEl.innerHTML = "";

          const summaryCards = [
            {
              title: "On shift now",
              value: data[6][27] || ""
            },
            {
              title: "Should be",
              value: data[6][29] || ""
            },
            {
              title: "CS",
              value: data[6][31] || "",
              away: data[8][31] || ""
            },
            {
              title: "CS/Post Order",
              value: data[6][33] || "",
              away: data[8][33] || ""
            },
            {
              title: "PSR",
              value: data[6][35] || "",
              away: data[8][35] || ""
            },
            {
              title: "Venue",
              value: data[6][37] || "",
              away: data[8][37] || ""
            },
            {
              title: "Aircall",
              value: data[6][39] || "",
              away: data[8][39] || ""
            },
            {
              title: "Simo",
              value: data[6][41] || "",
              away: data[8][41] || ""
            },
            {
              title: "ST",
              value: data[6][43] || "",
              away: data[8][43] || ""
            },
            {
              title: "Not here",
              value:
                (data[8][29] || "") +
                (data[10][29] ? ", " + data[10][29] : ""),
              customClass: "small-font-card"
            },
            {
              title: "WNATS",
              value:
                (data[8][27] || "") +
                (data[10][27] ? ", " + data[10][27] : ""),
              customClass: "small-font-card"
            }
          ];

          let html = `<div class="shift-summary-cards-container" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">`;

          summaryCards.forEach((card) => {
            html += `
              <div class="shift-card ${
                card.customClass ? card.customClass : ""
              }" style="
                background: var(--card-bg-color);
                color: var(--card-text-color);
                border-radius: 8px;
                box-shadow: var(--card-shadow);
                padding: 16px;
                min-width: 150px;
              ">
                <h6 class="shift-card-title">
                  ${card.title}
                </h6>
                <div style="margin-bottom: 0.5rem;">${card.value || ""}</div>
            `;
            if (card.away) {
              html += `
                <div class="shift-card-away">
                  <strong>Away:</strong> ${card.away}
                </div>
              `;
            }
            html += `</div>`;
          });

          html += `</div>`;
          tableEl.innerHTML = html;
        }

        function renderResponsiblePeople(data) {
  if (!data || data.length === 0) return;

  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é, –µ—Å–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  const existing = document.getElementById("responsible-card");
  if (existing) existing.remove();

  let html = `
    <div class="shift-summary-card" id="responsible-card">
      <div class="shift-summary-title">üë• Responsible People</div>
      <table class="shift-summary-grid" style="max-width: 500px; margin: 0 auto;">
        <thead>
          <tr>
            <th>Name</th>
            <th>Position</th>
          </tr>
        </thead>
        <tbody>`;

  data.forEach(row => {
    const name = row[0]?.trim() || "";
    const role = row[1]?.trim() || "";
    if (name && role) {
      html += `
        <tr>
          <td><span style="font-weight: bold;">${name}</span></td>
          <td><span style="background:#e7f1ff; color:#0056b3; padding: 2px 6px; border-radius: 6px; font-size: 0.85rem;">${role}</span></td>
        </tr>`;
    }
  });

  html += `</tbody></table></div>`;

  const container = document.getElementById("shift-summary");
  container.insertAdjacentHTML("afterend", html);
}



        async function fetchBreaksData() {
          window.allBreaksData = [];
          const data = await fetchSheetData(BREAKS_RANGE);
          if (!data) return;
          const breaksObjects = arrayToObjects(data);
          allBreaksData = breaksObjects;
          const now = new Date();
          const currMinutes = now.getHours() * 60 + now.getMinutes();
          let filteredBreaks = breaksObjects;
          if (currentBreakFilter === "upcoming") {
            const horizon = currMinutes + 60;
            filteredBreaks = breaksObjects.filter((item) => {
              if (!item["Break Time"]) return false;
              const timeStr = item["Break Time"].trim();
              const minutes = parseTimeToMinutes(timeStr);
              return minutes >= currMinutes && minutes <= horizon;
            });
            filteredBreaks.sort(
              (a, b) =>
                parseTimeToMinutes(a["Break Time"]) -
                parseTimeToMinutes(b["Break Time"])
            );
          } else if (currentBreakFilter === "all") {
            filteredBreaks.sort(
              (a, b) =>
                parseTimeToMinutes(a["Break Time"]) -
                parseTimeToMinutes(b["Break Time"])
            );
          }
          let html = `<div class="break-card">
                        <h5>${
                          currentBreakFilter === "upcoming"
                            ? "Upcoming breaks in the next hour"
                            : "All Breaks"
                        }</h5>
                        <ul>`;
          filteredBreaks.forEach((item) => {
            html += `
              <li>
                <strong>${item["Name"]}</strong><br/>
                Break at: <strong>${item["Break Time"]}</strong><br/>
                Shift: ${item["Shift Start Time"]} | ${item["Working Space"]}
              </li>`;
          });
          html += `</ul></div>`;
          document.getElementById("breaks-app").innerHTML = html;
        }

        function parseTimeToMinutes(timeStr) {
          timeStr = timeStr.trim();
          let parts = timeStr.split(":");
          if (parts.length < 2) return 0;
          let hours = parseInt(parts[0], 10);
          let minutes = parseInt(parts[1], 10);
          return hours * 60 + minutes;
        }

        function arrayToObjects(arr) {
          if (!arr.length) return [];
          const header = arr[0];
          return arr.slice(1).map((row) => {
            const obj = {};
            header.forEach((key, i) => {
              obj[key] = row[i] || "";
            });
            return obj;
          });
        }

        async function fetchAircallStatuses() {
          const activeElements = document.querySelectorAll(
            "[id^='aircall-active-']"
          );
          for (let elem of activeElements) {
            const name = elem.textContent.split(" - ")[0].trim();
            const email = generateWoltEmail(name);
            const userId = await getAircallUserId(email);
            if (!userId) {
              elem.querySelector("span").textContent = "No ID";
              continue;
            }
            const status = await getAircallAvailability(userId);
            elem.querySelector("span").textContent = status;
          }
        }

        let autoRefreshEnabled = true;
        let refreshInterval = 15;
        let refreshTimer = null;
        let countdownTimer = null;
        let countdownValue = refreshInterval;

        function resetAutoRefresh() {
          clearTimeout(refreshTimer);
          clearInterval(countdownTimer);
          countdownValue = refreshInterval;
          updateCountdownDisplay();
          refreshTimer = setTimeout(fetchData, refreshInterval * 1000);
          countdownTimer = setInterval(() => {
            countdownValue--;
            updateCountdownDisplay();
            if (countdownValue <= 0) clearInterval(countdownTimer);
          }, 1000);
        }
        function updateCountdownDisplay() {
          const countdownElem = document.getElementById("countdown");
          if (countdownElem) {
            countdownElem.textContent = countdownValue;
          }
        }
        function toggleAutoRefresh() {
          autoRefreshEnabled = !autoRefreshEnabled;
          const btn = document.getElementById("toggle-autorefresh");
          if (autoRefreshEnabled) {
            btn.textContent = "Disable Auto Refresh";
            resetAutoRefresh();
          } else {
            btn.textContent = "Enable Auto Refresh";
            clearTimeout(refreshTimer);
            clearInterval(countdownTimer);
          }
        }
        // –ö–Ω–æ–ø–∫–∞ Refresh Now –∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞—é—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é
        function refreshNow() {
          document.getElementById("refresh-spinner").style.display =
            "inline-block";
          fetchData();
        }

        async function fetchData() {
          document.getElementById("refresh-spinner").style.display =
            "inline-block";
          const data = await fetchSheetData(RANGE);
          if (!data) {
            document.getElementById("refresh-spinner").style.display = "none";
            return;
          }
          fetchedData = data;
          const shiftData = await fetchSheetData(SHIFT_RANGE);
          window.allShiftData = shiftData;

          await fetchEmployeeList();

          // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Aircall
          const aircallConfig = platforms.find((p) => p.name === "Aircall");
          aircallActive = [];
          aircallAway = [];
          for (
            let r = aircallConfig.rowActiveNamesStart;
            r <= aircallConfig.rowActiveNamesEnd;
            r++
          ) {
            const name = data[r]?.[aircallConfig.colIndexNames]?.trim();
            if (name) aircallActive.push(name);
          }
          for (
            let r = aircallConfig.rowAwayNamesStart;
            r <= aircallConfig.rowAwayNamesEnd;
            r++
          ) {
            const name = data[r]?.[aircallConfig.colIndexNames]?.trim();
            const reason = data[r]?.[aircallConfig.colIndexData]?.trim() || "";
            if (name) aircallAway.push({ name, reason });
          }

          renderShiftSummary(data);
          const responsiblesData = await fetchSheetData(RESPONSIBLES_RANGE);
          renderResponsiblePeople(responsiblesData);
          fetchBreaksData();
          applyFilters();
          fetchAircallStatuses();

          document.getElementById("refresh-spinner").style.display = "none";
          if (autoRefreshEnabled) resetAutoRefresh();
        }

        function generateWoltEmail(name) {
          if (!name) return "";
          const parts = name.split(" ");
          return parts.length < 2
            ? parts[0].toLowerCase() + "@wolt.com"
            : parts[0].toLowerCase() +
                "." +
                parts[1].toLowerCase() +
                "@wolt.com";
        }

        function loadThemePreference() {
          const saved = localStorage.getItem("darkThemeEnabled");
          if (saved === "true") {
            document.body.classList.add("dark-theme");
            const themeCheckbox = document.getElementById("theme-checkbox");
            if (themeCheckbox) themeCheckbox.checked = true;
          }
        }
        function toggleTheme(e) {
          const isDark = e.target.checked;
          document.body.classList.toggle("dark-theme", isDark);
          localStorage.setItem("darkThemeEnabled", isDark.toString());
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bootstrap-Select –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º
        $(document).ready(function () {
          $("#platform-dropdown").selectpicker();
          $("#platform-dropdown").on(
            "changed.bs.select",
            function (e, clickedIndex, isSelected, previousValue) {
              let selected = $(this).val();
              currentPlatformFilter = selected && selected.length ? selected : ["all"];
              applyFilters();
            }
          );
        });

        document.addEventListener("DOMContentLoaded", () => {
          loadThemePreference();

          document
            .getElementById("employee-search")
            .addEventListener("input", function (e) {
              currentSearchTerm = e.target.value;
              applyFilters();
            });
          document
            .getElementById("status-filter")
            .addEventListener("change", function (e) {
              currentStatusFilter = e.target.value;
              applyFilters();
            });
          document
            .getElementById("realloc-filter")
            .addEventListener("change", function (e) {
              currentReallocFilter = e.target.value;
              applyFilters();
            });
          document
            .getElementById("lang-filter")
            .addEventListener("change", function (e) {
              currentLangFilter = e.target.value;
              applyFilters();
            });
          document
            .getElementById("break-filter")
            .addEventListener("change", function (e) {
              currentBreakFilter = e.target.value;
              fetchBreaksData();
            });

          const overlay = document.getElementById("modal-overlay");
          const modalClose = document.getElementById("modal-close");
          overlay.addEventListener("click", closeEmployeeModal);
          modalClose.addEventListener("click", closeEmployeeModal);

          document
            .getElementById("theme-checkbox")
            .addEventListener("change", toggleTheme);

          document
            .getElementById("hamburger-menu")
            .addEventListener("click", function () {
              document.getElementById("sidebar").classList.toggle("active");
            });
          document
            .getElementById("sidebar-close")
            .addEventListener("click", function () {
              document.getElementById("sidebar").classList.remove("active");
            });

          fetchData();
          fetchWeather();
        });
      </script>
    </div>
  </body>
</html>
