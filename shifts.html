<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Today's Shifts</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #eef2f5;
      --accent: #4a90e2;
      --card-bg: rgba(255, 255, 255, 0.8);
      --text: #2c3e50;
      --heading: #1a252f;
      --border: rgba(44, 62, 80, 0.1);
      --gap: 1rem;
      --radius: 8px;
      --col-width: 260px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Montserrat', sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: var(--gap);
      line-height: 1.4;
      position: relative;
    }
    .back-btn {
      position: fixed;
      top: var(--gap);
      left: var(--gap);
      background: var(--accent);
      color: #fff;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      font-size: 0.9rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: background 0.3s;
      z-index: 1000;
    }
    .back-btn:hover {
      background: darken(var(--accent), 10%);
    }
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--heading);
      text-align: center;
      margin: var(--gap) 0;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: var(--gap);
      margin-bottom: var(--gap);
    }
    .controls input {
      padding: 0.5rem 0.75rem;
      font-size: 0.9rem;
      border: none;
      border-radius: var(--radius);
      box-shadow: 0 1px 6px rgba(0,0,0,0.1);
      width: 200px;
      backdrop-filter: blur(6px);
      background: var(--card-bg);
      transition: box-shadow 0.2s;
    }
    .controls input:focus {
      outline: none;
      box-shadow: 0 1px 8px var(--accent);
    }
    #shifts-container {
      display: flex;
      gap: var(--gap);
      overflow-x: auto;
      padding-bottom: var(--gap);
      width: 100%;
      align-items: flex-start;
    }
    .shift-column {
      flex: 0 0 var(--col-width);
      background: var(--card-bg);
      backdrop-filter: blur(6px);
      border-radius: var(--radius);
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s;
      align-items: flex-start;
    }
    .shift-column:hover { transform: translateY(-3px); }
    .shift-column h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.25rem;
      color: var(--accent);
      margin-bottom: 0.75rem;
      border-bottom: 2px solid var(--accent);
      padding-bottom: 0.25rem;
      text-align: center;
      width: 100%;
    }
    .shift-column ul { list-style: none; margin: 0; padding: 0; }
    .shift-column li {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border);
      transition: background 0.2s, color 0.2s, opacity 0.2s;
    }
    .shift-column li:last-child { border-bottom: none; }
    .shift-column li:hover { background: rgba(74,144,226,0.05); }
    .shift-column li.past { color: #888888; opacity: 0.6; }
    .shift-column li.present { background: rgba(76,175,80,0.15); }
    .shift-column li.future { background: rgba(255,152,0,0.15); }
    .shift-column li .time { font-weight: 600; color: var(--heading); font-size: 0.9rem; }
    .shift-column li .name { font-weight: 500; color: var(--text); font-size: 0.9rem; }
    #shifts-container::-webkit-scrollbar { height: 6px; }
    #shifts-container::-webkit-scrollbar-track { background: transparent; }
    #shifts-container::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.2); border-radius: 3px; }
  </style>
</head>
<body>
  <a href="https://mikhailgarayev.github.io/shldashboard/index.html" class="back-btn">‚Üê Back to Dashboard</a>
  <h1>üìÖ Today's Shifts by Platform</h1>
  <div class="controls">
    <input type="text" id="search-name" placeholder="üîç –ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞" />
    <input type="text" id="filter-shift" placeholder="‚è∞ –§–∏–ª—å—Ç—Ä –ø–æ —Å–º–µ–Ω–µ" />
  </div>
  <div id="shifts-container">Loading...</div>
<script>
  const SHEETS_PROXY_URL = "https://sheets-proxy.mikhail-garayev.workers.dev";
  let allShifts = [];
  async function fetchSheetData(range) {
    try {
      const res = await fetch(SHEETS_PROXY_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ secret: "superWoltKey42", range })
      });
      const data = await res.json();
      return data.values;
    } catch (e) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", e);
      return null;
    }
  }
  function filterAndRender() {
    const nameTerm = document.getElementById('search-name').value.trim().toLowerCase();
    const shiftTerm = document.getElementById('filter-shift').value.trim().toLowerCase();
    const filtered = allShifts.filter(({ name, shift }) =>
      (!nameTerm || name.toLowerCase().includes(nameTerm)) &&
      (!shiftTerm || shift.toLowerCase().includes(shiftTerm))
    );
    renderGroups(filtered);
  }
  function renderGroups(rows) {
    const now = new Date();
    const groups = rows.reduce((acc, row) => { (acc[row.platform] = acc[row.platform] || []).push(row); return acc; }, {});
    const container = document.getElementById('shifts-container');
    container.innerHTML = '';
    Object.keys(groups).sort().forEach(plat => {
      const col = document.createElement('div'); col.className = 'shift-column';
      const items = groups[plat].map(item => {
        const [start,end] = item.shift.split(/\s*-\s*/);
        const [sh,sm] = start.split(':').map(Number);
        const [eh,em] = end.split(':').map(Number);
        const startDt=new Date(now); startDt.setHours(sh,sm,0,0);
        let endDt=new Date(now); endDt.setHours(eh,em,0,0);
        if(endDt<=startDt) endDt.setDate(endDt.getDate()+1);
        const cls = now<startDt?'future': now> endDt?'past':'present';
        return `<li class="${cls}"><span class="time">${item.shift}</span><span class="name">${item.name}</span></li>`;
      }).join('');
      col.innerHTML=`<h2>${plat}</h2><ul>${items}</ul>`;
      container.appendChild(col);
    });
  }
  async function init() {
    const raw = await fetchSheetData("shiftsquinyx!A2:C");
    if (!raw) { document.getElementById('shifts-container').innerHTML='<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>'; return; }
    allShifts = raw.filter(r=>r[0]&&r[1]&&r[2]).map(r=>({platform:r[0].trim(),name:r[1].trim(),shift:r[2].trim()}));
    if(allShifts.length===0){document.getElementById('shifts-container').innerHTML='<p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è —Å–º–µ–Ω –Ω–µ—Ç</p>';return;}
    document.getElementById('search-name').addEventListener('input',filterAndRender);
    document.getElementById('filter-shift').addEventListener('input',filterAndRender);
    filterAndRender();
  }
  document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
