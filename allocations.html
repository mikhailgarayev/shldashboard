<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Today's Shifts</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
  <style>
    /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–º–µ–Ω */
    #shifts-container {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 1rem;
    }
    /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–∫–∏ */
    .shift-column {
      min-width: 250px;
    }
    .shift-column h2 {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
    }
    .shift-column ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .shift-column li {
      padding: 0.25rem 0;
      border-bottom: 1px solid #dee2e6;
    }
    .shift-column li:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body>
  <div class="container my-4">
    <h1 class="mb-4">üìÖ Today's Shifts by Platform</h1>
    <div id="shifts-container">Loading...</div>
  </div>
<script>
  const SHEETS_PROXY_URL = "https://sheets-proxy.mikhail-garayev.workers.dev";
  
  async function fetchSheetData(range) {
    try {
      const res = await fetch(SHEETS_PROXY_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ secret: "superWoltKey42", range })
      });
      const data = await res.json();
      return data.values;
    } catch (e) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", e);
      return null;
    }
  }
  
  async function renderShifts() {
    const raw = await fetchSheetData("shiftsquinyx!A2:C");
    const container = document.getElementById("shifts-container");
    if (!raw) {
      container.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö";
      return;
    }
    const rows = raw
      .filter(r => r[0] && r[1] && r[2])
      .map(r => ({ platform: r[0].trim(), name: r[1].trim(), shift: r[2].trim() }));
    if (rows.length === 0) {
      container.textContent = "–ù–∞ —Å–µ–≥–æ–¥–Ω—è —Å–º–µ–Ω –Ω–µ—Ç";
      return;
    }
    const groups = rows.reduce((acc, row) => {
      (acc[row.platform] = acc[row.platform] || []).push(row);
      return acc;
    }, {});
    container.innerHTML = '';
    Object.keys(groups).sort().forEach(plat => {
      let section = `<div class=\"shift-column\"><h2>${plat}</h2><ul>`;
      groups[plat].forEach(({ name, shift }) => {
        section += `<li>${shift} ‚Äî ${name}</li>`;
      });
      section += `</ul></div>`;
      container.innerHTML += section;
    });
  }
  
  document.addEventListener("DOMContentLoaded", renderShifts);
</script>
</body>
</html>
